<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4th Downs in the NFL - Heckman Selection Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">4th Downs in the NFL</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./heckman.html" rel="" target="" aria-current="page">
 <span class="menu-text">Heckman Selection</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./xgboost.html" rel="" target="">
 <span class="menu-text">XGBoost Prediction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./attendance.html" rel="" target="">
 <span class="menu-text">Attendance Impact</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./thirddown.html" rel="" target="">
 <span class="menu-text">Third Down Analysis</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-2-outcome_data" id="toc-step-2-outcome_data" class="nav-link active" data-scroll-target="#step-2-outcome_data">step 2 outcome_data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Heckman Selection Analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"predict_outcome.csv.gz"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>select_data <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"predict_select.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>select_data[, attempt <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(attempt))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the XGBoost matrices</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span> <span class="sc">-</span> attempt <span class="sc">-</span> my_id, <span class="at">data =</span> select_data)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(select_data<span class="sc">$</span>attempt))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create parameter grid</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.002</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">seq</span>(<span class="dv">7</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),        </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),                </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">by =</span> <span class="dv">1</span>),                  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),               </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">seq</span>(<span class="dv">300</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">50</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample grid points</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>conf_lev <span class="ot">&lt;-</span> .<span class="dv">95</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>num_max <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>conf_lev)<span class="sc">/</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>num_max<span class="sc">/</span><span class="fu">nrow</span>(grid)))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grid), n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>rgrid <span class="ot">&lt;-</span> grid[ind, ]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up parallel processing</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation phase</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Phase 1: Validation Phase</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Phase 1: Validation Phase</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>n_validations <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>validation_results <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(rgrid), <span class="at">ncol =</span> n_validations)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rgrid)) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("\nTesting parameter set", j, "of", nrow(rgrid), "\n")</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_validations) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create validation split</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs), T))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    train_x <span class="ot">&lt;-</span> xs[idx, ]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    train_y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    val_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>idx, ]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    val_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>idx]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Undersample majority class in training data</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    train_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    train_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get number of minority class samples</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    n_minority <span class="ot">&lt;-</span> <span class="fu">length</span>(train_idx_1)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly sample from majority class</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    train_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(train_idx_0, n_minority)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine indices for balanced dataset</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(train_idx_0_sampled, train_idx_1)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create balanced training dataset</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    train_x_balanced <span class="ot">&lt;-</span> train_x[balanced_idx, ]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    train_y_balanced <span class="ot">&lt;-</span> train_y[balanced_idx]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    prm <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">booster =</span> <span class="st">"gbtree"</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> rgrid[j, <span class="st">"max_depth"</span>],</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> rgrid[j, <span class="st">"eta"</span>],</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> rgrid[j, <span class="st">"subsample"</span>],</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> rgrid[j, <span class="st">"colsample_bytree"</span>],</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">gamma =</span> rgrid[j, <span class="st">"gamma"</span>],</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> rgrid[j, <span class="st">"min_child_weight"</span>],</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> rgrid[j, <span class="st">"alpha"</span>],</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">lambda =</span> rgrid[j, <span class="st">"lambda"</span>],</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">nthread =</span> nc</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    dm_train <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_x_balanced, <span class="at">label =</span> train_y_balanced)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    mdl <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> prm,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dm_train,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> rgrid[j, <span class="st">"nrounds"</span>],</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> val_x))</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(p, val_y)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    validation_results[j, i] <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mean AUC:"</span>, <span class="fu">mean</span>(validation_results[j,]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"SD AUC:"</span>, <span class="fu">sd</span>(validation_results[j,]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean AUC: 0.8928687 
SD AUC: 0.002219201 
Mean AUC: 0.8934187 
SD AUC: 0.003375792 
Mean AUC: 0.8921612 
SD AUC: 0.002213305 
Mean AUC: 0.8961577 
SD AUC: 0.002887228 
Mean AUC: 0.8931309 
SD AUC: 0.00411613 
Mean AUC: 0.895111 
SD AUC: 0.003076602 
Mean AUC: 0.8943179 
SD AUC: 0.003110912 
Mean AUC: 0.8891006 
SD AUC: 0.003147935 
Mean AUC: 0.891942 
SD AUC: 0.005023038 
Mean AUC: 0.8944732 
SD AUC: 0.004132359 
Mean AUC: 0.8904752 
SD AUC: 0.004628984 
Mean AUC: 0.8914807 
SD AUC: 0.003424596 
Mean AUC: 0.8911096 
SD AUC: 0.004419039 
Mean AUC: 0.8906527 
SD AUC: 0.003392062 
Mean AUC: 0.8947199 
SD AUC: 0.003261726 
Mean AUC: 0.894016 
SD AUC: 0.003912425 
Mean AUC: 0.8943638 
SD AUC: 0.005441515 
Mean AUC: 0.8894262 
SD AUC: 0.002819145 
Mean AUC: 0.8928653 
SD AUC: 0.003266988 
Mean AUC: 0.894653 
SD AUC: 0.00377426 
Mean AUC: 0.8891884 
SD AUC: 0.003064619 
Mean AUC: 0.8951035 
SD AUC: 0.002926029 
Mean AUC: 0.8905375 
SD AUC: 0.002263456 
Mean AUC: 0.8890496 
SD AUC: 0.003755673 
Mean AUC: 0.8947758 
SD AUC: 0.002942581 
Mean AUC: 0.8944242 
SD AUC: 0.003549329 
Mean AUC: 0.8920346 
SD AUC: 0.003388274 
Mean AUC: 0.8942147 
SD AUC: 0.00432595 
Mean AUC: 0.8957706 
SD AUC: 0.003755223 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run 100 tests with best parameters</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Running 100 test iterations with best parameters...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Running 100 test iterations with best parameters...</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>test_aucs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>best_params_idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">rowMeans</span>(validation_results))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> rgrid[best_params_idx,]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model with best parameters</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>best_params_list <span class="ot">&lt;-</span> <span class="fu">as.list</span>(best_params[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(best_params) <span class="sc">==</span> <span class="st">"nrounds"</span>)])</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>booster <span class="ot">&lt;-</span> <span class="st">"gbtree"</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>objective <span class="ot">&lt;-</span> <span class="st">"binary:logistic"</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>nthread <span class="ot">&lt;-</span> nc</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("\nIteration", i, "of 100\n")       </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create test split</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs), T))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  train_x <span class="ot">&lt;-</span> xs[idx, ]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  train_y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  test_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>idx, ]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  test_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>idx]</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Undersample training data</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  train_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  train_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  n_minority <span class="ot">&lt;-</span> <span class="fu">length</span>(train_idx_1)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  train_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(train_idx_0, n_minority)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(train_idx_0_sampled, train_idx_1)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create balanced training dataset</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  train_x_balanced <span class="ot">&lt;-</span> train_x[balanced_idx, ]</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  train_y_balanced <span class="ot">&lt;-</span> train_y[balanced_idx]</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train model</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  dm_train <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_x_balanced, <span class="at">label =</span> train_y_balanced)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  mdl <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> best_params_list,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dm_train,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> best_params[[<span class="st">"nrounds"</span>]],</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test on unbalanced test set</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x))</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(p, test_y)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  test_aucs[i] <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Test Results over 100 iterations:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Test Results over 100 iterations:</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean AUC:"</span>, <span class="fu">mean</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean AUC: 0.8939356 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SD AUC:"</span>, <span class="fu">sd</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>SD AUC: 0.003880849 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"95% CI:"</span>, <span class="fu">mean</span>(test_aucs) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(test_aucs), </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"to"</span>, <span class="fu">mean</span>(test_aucs) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>95% CI: 0.8863291 to 0.901542 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now train final model on full data for z scores</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>final_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>final_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>n_minority_final <span class="ot">&lt;-</span> <span class="fu">length</span>(final_idx_1)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>final_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(final_idx_0, n_minority_final)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>final_balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(final_idx_0_sampled, final_idx_1)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create balanced final dataset</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>xs_balanced <span class="ot">&lt;-</span> xs[final_balanced_idx, ]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>y_balanced <span class="ot">&lt;-</span> y[final_balanced_idx]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>dm_full <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> xs_balanced, <span class="at">label =</span> y_balanced)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>final_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> best_params_list,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dm_full,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> best_params[[<span class="st">"nrounds"</span>]],</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get probability predictions (z) for ALL data</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_model, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> xs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals for XGBoost predictions</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(select_data<span class="sc">$</span>attempt))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> z</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of residuals</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(residuals, <span class="at">main=</span><span class="st">"Distribution of XGBoost Model Residuals"</span>, <span class="at">xlab=</span><span class="st">"Residual"</span>, <span class="at">breaks=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="heckman_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot out the z values\</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(z), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Density of Z Predictions"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Predicted Probability of Attempt"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="heckman_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate GIMR (lambda) This is Generalized inverse mills ratio</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>GIMR <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(<span class="fu">qnorm</span>(z)) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">qnorm</span>(z)))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GIMR to the data</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>select_data[, GIMR <span class="sc">:</span><span class="er">=</span> GIMR]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print variable importa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data.table with just my_id and GIMR from select_data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>GIMR_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">my_id =</span> select_data<span class="sc">$</span>my_id, <span class="at">GIMR =</span> GIMR)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GIMR to outcome_data by matching on my_id</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>outcome_data[GIMR_dt, GIMR <span class="sc">:</span><span class="er">=</span> i.GIMR, on <span class="ot">=</span> <span class="st">"my_id"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="step-2-outcome_data" class="level1">
<h1>step 2 outcome_data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#kill - my_id</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> outcome_data[, my_id <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>outcome_data[, year2017_team_ARI <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> outcome_data[, yardline_1_10<span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>outcome_data[, conversion <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(conversion))]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Then run OLS with GIMR correction</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ols_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(conversion <span class="sc">~</span>  ., <span class="at">data =</span> outcome_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lmtest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lmtest' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'zoo' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sandwich"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sandwich' was built under R version 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># heroskedastic adjusted SEs</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols_model, <span class="at">vcov =</span> <span class="fu">vcovHC</span>(ols_model, <span class="at">type =</span> <span class="st">"HC0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                                                                        Estimate
(Intercept)                                                           7.1150e-01
ydstogo                                                              -1.1451e-01
posteam_timeouts_remaining                                            9.7148e-03
defteam_timeouts_remaining                                            7.8770e-03
rush_attempt                                                          1.5227e-01
week                                                                  9.5112e-03
temp                                                                 -5.1834e-03
wind                                                                  9.8529e-03
vegas_wp                                                              1.4155e-02
vegas_wp_posteam                                                      7.9166e-03
total_line                                                            2.7742e-02
prep_days                                                             5.3842e-03
overall_win_pct                                                      -6.4187e-04
team_win_pct                                                          7.2257e-03
prev_shotgun_rate                                                     1.4157e-02
prev_singleback_rate                                                  7.4373e-03
prev_empty_rate                                                       1.1194e-02
prev_shotgun_success                                                 -1.6918e-02
prev_singleback_success                                               8.9708e-03
prev_empty_success                                                    5.7604e-03
prev_stop_rate_run                                                    7.5099e-03
prev_stop_rate_pass                                                  -3.1751e-02
shotgun_rate                                                          2.0177e-02
singleback_rate                                                       1.0133e-02
empty_rate                                                            1.2178e-03
shotgun_success                                                      -1.7393e-02
singleback_success                                                   -1.1163e-02
empty_success                                                        -5.4988e-03
def_stop_rate_run                                                     1.7250e-02
def_stop_rate_pass                                                   -1.0520e-02
avg_pass_rushers                                                     -8.7101e-03
avg_box_defenders                                                    -6.7153e-03
cover0_rate                                                          -4.1779e-03
cover1_rate                                                          -8.8622e-03
cover2_rate                                                           7.3645e-04
cover3_rate                                                           2.8177e-02
cover4_rate                                                           1.9290e-02
cover6_rate                                                          -3.0357e-03
two_man_rate                                                          1.3850e-02
prevent_rate                                                          2.1179e-02
home_attendance                                                       3.3097e-03
roof_outdoors                                                         3.3172e-03
posteam_type_away                                                     1.4264e-02
offense_formation_EMPTY                                               2.9394e-02
offense_formation_SHOTGUN                                             6.2367e-03
offense_formation_SINGLEBACK                                          4.7048e-03
offense_player_1_present                                              4.9564e-01
offense_player_2_present                                             -1.5454e-01
offense_player_4_present                                              5.2852e-04
offense_player_5_present                                             -8.0013e-03
offense_player_6_present                                             -1.9005e-01
offense_player_8_present                                             -2.5685e-01
offense_player_9_present                                             -3.3190e-01
offense_player_10_present                                            -2.6937e-02
offense_player_11_present                                            -7.2780e-02
offense_player_12_present                                             5.1771e-01
offense_player_14_present                                            -2.2806e-02
offense_player_15_present                                            -6.9968e-02
offense_player_16_present                                            -5.7419e-02
offense_player_17_present                                            -3.6560e-01
offense_player_20_present                                             7.3726e-02
offense_player_22_present                                            -9.5196e-02
offense_player_23_present                                             1.7092e-01
offense_player_24_present                                            -9.9022e-01
offense_player_9_receiving_concept_screen_grades_pass_route_12w      -5.2249e-02
offense_player_9_receiving_depth_medium_yards_per_reception_12w      -5.1326e-02
offense_player_9_receiving_grades_yprr_12w                           -1.0304e-02
offense_player_9_blocking_grades_grades_offense_12w                   1.0634e-01
offense_player_9_run_blocking_zone_snap_counts_run_block_12w          2.0216e-02
offense_player_1_offense_blocking_grades_offense_3y                   1.1984e-02
offense_player_9_run_blocking_gap_grades_run_block_12w                6.1639e-02
offense_player_9_receiving_vs_scheme_zone_targets_percent_12w        -9.1137e-03
offense_player_1_passing_concept_pa_grades_offense_12w                1.5814e-03
offense_player_1_passing_concept_pa_qb_rating_12w                     1.1380e-02
offense_player_9_receiving_concept_slot_grades_pass_route_12w         4.1312e-03
offense_player_9_blocking_grades_block_percent_12w                   -3.6922e-02
offense_player_14_run_blocking_snap_counts_run_block_12w              5.1088e-03
offense_player_4_rushing_grades_first_downs_12w                       5.3685e-03
offense_player_8_blocking_grades_snap_counts_run_block_12w            2.1623e-02
offense_player_9_receiving_vs_scheme_man_pass_plays_12w              -1.6134e-02
offense_player_9_receiving_grades_grades_offense_12w                 -4.8509e-02
offense_player_14_pass_blocking_pass_block_percent_2w                 1.5036e-02
offense_player_9_receiving_depth_medium_longest_12w                   2.6604e-02
offense_player_9_receiving_depth_medium_receptions_12w               -3.7480e-02
offense_player_9_receiving_vs_scheme_zone_route_rate_12w              1.0694e-01
defense_player_1_present                                             -1.7866e-01
defense_player_2_present                                              8.2541e-02
defense_player_3_present                                              4.8260e-02
defense_player_4_present                                             -3.1901e-02
defense_player_5_present                                             -5.6833e-02
defense_player_6_present                                             -4.9776e-02
defense_player_9_present                                              7.9475e-02
defense_player_10_present                                            -4.8611e-03
defense_player_11_present                                            -1.4918e-02
defense_player_12_present                                            -6.6064e-03
defense_player_13_present                                             1.2614e-01
defense_player_14_present                                             1.0031e-01
defense_player_15_present                                             5.5326e-02
defense_player_16_present                                             4.0834e-03
defense_player_17_present                                             1.2102e-02
defense_player_18_present                                             5.2036e-02
defense_player_19_present                                             8.1923e-02
defense_player_20_present                                            -6.7798e-02
defense_player_21_present                                             4.6197e-02
defense_player_22_present                                             2.7621e-02
defense_player_23_present                                             5.4861e-02
defense_player_3_defensive_grades_snap_counts_run_defense_12w        -7.8744e-02
defense_player_3_defensive_grades_snap_counts_dl_b_gap_12w           -9.0431e-03
defense_player_3_defensive_grades_grades_tackle_12w                   2.7564e-01
defense_player_3_run_defense_grades_grades_defense_12w                7.2280e-02
defense_player_3_run_defense_grades_grades_tackle_12w                -2.4321e-01
defense_player_3_run_defense_grades_tackles_12w                       4.1927e-02
defense_player_3_pass_rush_grades_grades_pass_rush_defense_12w       -4.0442e-02
defense_player_3_pass_rushing_productivity_lhs_pass_rush_snaps_12w   -1.4596e-02
defense_player_3_run_defense_grades_run_stop_opp_12w                  1.9456e-02
defense_player_3_defensive_grades_snap_counts_defense_12w             3.7392e-01
defense_player_3_pass_rush_grades_snap_counts_pass_play_12w          -1.9723e-01
defense_player_3_run_defense_grades_snap_counts_run_12w              -3.6626e-02
defense_player_3_defensive_grades_assists_12w                        -4.8063e-03
defense_player_3_defense_summary_grades_defense_3y                    7.8672e-02
defense_player_3_defensive_grades_stops_12w                          -5.6823e-02
defense_player_3_defensive_grades_snap_counts_pass_rush_12w          -5.7078e-02
defense_player_3_defensive_grades_grades_run_defense_12w             -9.9935e-02
defense_player_3_pass_rushing_productivity_pass_rush_percent_12w     -2.7334e-02
defense_player_3_pass_rushing_productivity_lhs_pass_rush_percent_12w  2.9876e-02
defense_player_3_defense_summary_grades_run_defense_3y               -3.9944e-02
defense_player_3_run_defense_grades_grades_defense_penalty_12w        1.2845e-02
defense_player_20_slot_coverage_coverage_snaps_12w                    1.4606e-02
defense_player_3_pass_rush_grades_pass_rush_wins_12w                  1.8035e-02
defense_player_3_defense_summary_snap_counts_pass_rush_3y            -2.4075e-02
defense_player_3_run_defense_grades_stops_12w                        -4.2732e-03
yardline_11_20                                                        7.6439e-02
yardline_21_30                                                        6.7315e-02
yardline_31_40                                                        6.7279e-02
yardline_41_50                                                        1.0999e-01
yardline_51_60                                                        7.8616e-02
yardline_61_70                                                        1.1016e-01
yardline_71_80                                                        1.3624e-01
yardline_81_90                                                        1.9305e-01
yardline_91_100                                                       1.4032e-01
year2017_team_BUF                                                    -1.5786e-01
year2017_team_CHI                                                     4.6842e-02
year2017_team_CLE                                                     2.1342e-01
year2017_team_DAL                                                    -1.7272e-01
year2017_team_DET                                                    -7.7752e-02
year2017_team_GB                                                      3.4769e-01
year2017_team_HOU                                                     2.7197e-01
year2017_team_MIA                                                    -2.3783e-01
year2017_team_MIN                                                    -1.2873e-01
year2017_team_NE                                                     -4.7380e-02
year2017_team_SF                                                      2.9956e-01
year2017_team_BAL                                                     3.6275e-02
year2017_team_DEN                                                    -1.4616e-03
year2017_team_LA                                                      2.7433e-02
year2017_team_NYG                                                    -1.1806e-01
year2017_team_OAK                                                    -1.6553e-01
year2017_team_SEA                                                     1.1145e-01
year2017_team_CAR                                                     9.2744e-02
year2017_team_CIN                                                     1.8138e-01
year2017_team_IND                                                     1.4613e-01
year2017_team_NO                                                      1.5822e-01
year2017_team_PHI                                                     9.2529e-02
year2017_team_PIT                                                    -1.6473e-01
year2017_team_TEN                                                    -3.4326e-02
year2017_team_WAS                                                     5.0772e-02
year2017_team_KC                                                      2.3282e-01
year2017_team_LAC                                                    -6.8991e-02
year2017_team_NYJ                                                     1.4353e-01
year2017_team_TB                                                      2.0010e-02
year2017_team_ATL                                                     8.7019e-05
year2017_team_JAX                                                     7.8379e-02
year2018_team_ARI                                                    -2.9511e-02
year2018_team_BAL                                                     3.3675e-02
year2018_team_CAR                                                     2.4183e-02
year2018_team_CLE                                                    -5.2585e-02
year2018_team_DET                                                     6.1650e-02
year2018_team_HOU                                                     1.3113e-01
year2018_team_IND                                                    -1.1337e-01
year2018_team_KC                                                      8.2545e-02
year2018_team_NYG                                                     1.0375e-01
year2018_team_OAK                                                    -1.1210e-01
year2018_team_PHI                                                     2.9215e-02
year2018_team_SEA                                                    -1.4058e-01
year2018_team_BUF                                                    -1.2226e-01
year2018_team_CHI                                                    -2.8471e-02
year2018_team_CIN                                                    -1.3021e-01
year2018_team_DAL                                                    -7.6036e-02
year2018_team_DEN                                                    -3.5936e-02
year2018_team_GB                                                     -7.4838e-02
year2018_team_LAC                                                    -2.1565e-02
year2018_team_NE                                                     -7.2909e-02
year2018_team_NO                                                      8.5800e-02
year2018_team_PIT                                                     1.0907e-01
year2018_team_SF                                                      7.8879e-02
year2018_team_MIA                                                     2.5583e-02
year2018_team_MIN                                                    -3.0354e-02
year2018_team_NYJ                                                     1.3755e-01
year2018_team_TB                                                      9.7062e-02
year2018_team_ATL                                                     6.5615e-02
year2018_team_JAX                                                    -3.5876e-02
year2018_team_LA                                                     -1.9795e-01
year2018_team_TEN                                                     8.8431e-02
year2018_team_WAS                                                    -1.4069e-02
year2019_team_ARI                                                    -9.1126e-02
year2019_team_BUF                                                    -1.2661e-01
year2019_team_CHI                                                     4.2445e-02
year2019_team_CLE                                                     1.0015e-01
year2019_team_DAL                                                    -9.4143e-02
year2019_team_IND                                                    -1.0960e-01
year2019_team_JAX                                                     4.7280e-02
year2019_team_KC                                                     -1.8969e-02
year2019_team_LAC                                                    -1.5438e-01
year2019_team_MIN                                                    -1.4676e-01
year2019_team_NE                                                      3.7966e-02
year2019_team_NO                                                     -1.9419e-01
year2019_team_PHI                                                    -2.8161e-02
year2019_team_SEA                                                    -1.1926e-02
year2019_team_SF                                                     -2.3642e-02
year2019_team_TB                                                     -5.5729e-02
year2019_team_BAL                                                     1.5902e-02
year2019_team_CAR                                                    -9.0280e-02
year2019_team_DEN                                                     7.2985e-02
year2019_team_DET                                                    -1.5028e-01
year2019_team_HOU                                                    -8.3377e-02
year2019_team_LA                                                     -1.6029e-01
year2019_team_MIA                                                    -2.6778e-01
year2019_team_NYG                                                    -1.3200e-01
year2019_team_NYJ                                                    -2.4885e-01
year2019_team_OAK                                                    -1.0780e-01
year2019_team_PIT                                                    -2.9720e-01
year2019_team_TEN                                                    -1.6384e-01
year2019_team_CIN                                                     9.3552e-02
year2019_team_WAS                                                    -9.8914e-02
year2019_team_ATL                                                    -8.3202e-03
year2019_team_GB                                                     -1.0525e-01
year2020_team_ATL                                                     2.1586e-02
year2020_team_BAL                                                     8.3383e-02
year2020_team_BUF                                                     1.2302e-03
year2020_team_CAR                                                     1.0361e-01
year2020_team_CIN                                                     1.7470e-01
year2020_team_DEN                                                    -8.7922e-02
year2020_team_DET                                                    -1.3495e-01
year2020_team_JAX                                                    -1.1703e-01
year2020_team_KC                                                      6.4978e-02
year2020_team_LA                                                     -2.0518e-01
year2020_team_MIN                                                     1.1101e-01
year2020_team_NE                                                     -8.8176e-02
year2020_team_NO                                                      9.2083e-03
year2020_team_NYG                                                    -1.8330e-02
year2020_team_SF                                                     -1.8636e-02
year2020_team_WAS                                                    -9.3387e-03
year2020_team_CHI                                                    -2.0659e-02
year2020_team_DAL                                                    -2.1627e-02
year2020_team_GB                                                     -4.8380e-02
year2020_team_HOU                                                    -9.3162e-02
year2020_team_MIA                                                    -1.5517e-01
year2020_team_NYJ                                                    -1.5758e-02
year2020_team_TB                                                      8.8609e-02
year2020_team_TEN                                                    -7.9987e-02
year2020_team_ARI                                                     9.2227e-02
year2020_team_CLE                                                    -2.2973e-01
year2020_team_IND                                                    -8.2090e-02
year2020_team_LAC                                                     6.0668e-02
year2020_team_PHI                                                     7.9766e-02
year2020_team_SEA                                                    -6.0832e-02
year2020_team_LV                                                      1.0431e-01
year2020_team_PIT                                                    -1.0737e-01
year2021_team_ATL                                                    -1.8699e-01
year2021_team_BUF                                                     6.1553e-02
year2021_team_CIN                                                    -1.8946e-01
year2021_team_DAL                                                    -5.3022e-02
year2021_team_DEN                                                     1.3133e-02
year2021_team_DET                                                    -7.5360e-02
year2021_team_KC                                                      5.5803e-03
year2021_team_LA                                                     -9.1923e-02
year2021_team_LV                                                      4.0741e-02
year2021_team_MIN                                                    -6.7850e-02
year2021_team_NE                                                      6.5214e-02
year2021_team_NO                                                     -4.3416e-02
year2021_team_NYG                                                     2.9279e-02
year2021_team_SF                                                     -2.8206e-02
year2021_team_TEN                                                    -7.4583e-02
year2021_team_ARI                                                     5.3464e-02
year2021_team_BAL                                                     1.1288e-01
year2021_team_CAR                                                    -9.3789e-02
year2021_team_CHI                                                    -2.5832e-01
year2021_team_GB                                                      6.7072e-02
year2021_team_IND                                                    -7.0682e-02
year2021_team_LAC                                                    -2.7766e-03
year2021_team_MIA                                                     3.1647e-02
year2021_team_NYJ                                                    -1.4498e-02
year2021_team_PHI                                                    -1.7870e-01
year2021_team_SEA                                                    -2.2855e-01
year2021_team_TB                                                      1.1738e-02
year2021_team_WAS                                                    -1.3990e-01
year2021_team_CLE                                                    -1.3949e-01
year2021_team_HOU                                                    -1.2683e-02
year2021_team_JAX                                                    -2.3060e-02
year2021_team_PIT                                                    -4.8535e-02
year2022_team_ARI                                                    -2.4608e-01
year2022_team_ATL                                                    -3.0524e-01
year2022_team_CAR                                                     5.8774e-02
year2022_team_CHI                                                    -1.0641e-01
year2022_team_CIN                                                    -1.3427e-01
year2022_team_HOU                                                    -9.7597e-02
year2022_team_IND                                                    -1.1640e-01
year2022_team_LAC                                                    -1.0814e-01
year2022_team_MIA                                                    -1.7967e-01
year2022_team_SEA                                                    -4.5539e-02
year2022_team_TB                                                      3.7624e-03
year2022_team_TEN                                                     1.0142e-01
year2022_team_WAS                                                    -6.9839e-02
year2022_team_BAL                                                    -2.4035e-01
year2022_team_BUF                                                     8.6563e-02
year2022_team_DAL                                                    -1.9858e-02
year2022_team_DET                                                    -9.1983e-02
year2022_team_GB                                                     -1.6437e-01
year2022_team_JAX                                                    -1.5937e-01
year2022_team_KC                                                     -1.3252e-01
year2022_team_LA                                                      1.0294e-01
year2022_team_LV                                                      8.3650e-02
year2022_team_NO                                                     -6.9554e-02
year2022_team_PHI                                                     6.0948e-02
year2022_team_PIT                                                     1.1803e-01
year2022_team_CLE                                                    -2.5251e-02
year2022_team_DEN                                                    -1.0518e-02
year2022_team_MIN                                                    -1.1948e-01
year2022_team_NE                                                      1.1049e-02
year2022_team_NYJ                                                    -1.3918e-01
year2022_team_NYG                                                    -1.0419e-01
year2022_team_SF                                                     -2.3351e-01
year2023_team_BAL                                                    -1.2033e-01
year2023_team_CHI                                                    -1.9478e-01
year2023_team_CLE                                                    -2.0421e-01
year2023_team_GB                                                      3.5517e-03
year2023_team_IND                                                     1.8285e-02
year2023_team_KC                                                     -4.1769e-03
year2023_team_LAC                                                     6.6991e-03
year2023_team_LV                                                      9.6305e-03
year2023_team_MIA                                                     3.3959e-02
year2023_team_MIN                                                     1.0362e-01
year2023_team_NO                                                     -8.8103e-02
year2023_team_NYG                                                     4.6074e-02
year2023_team_SEA                                                    -2.4867e-01
year2023_team_SF                                                      1.3604e-02
year2023_team_WAS                                                     7.1409e-02
year2023_team_ATL                                                    -1.8162e-01
year2023_team_BUF                                                    -1.0878e-01
year2023_team_CAR                                                     3.8586e-03
year2023_team_DAL                                                     3.3414e-02
year2023_team_DEN                                                    -3.7015e-02
year2023_team_HOU                                                    -2.7741e-03
year2023_team_LA                                                      2.2664e-02
year2023_team_NE                                                     -4.9879e-02
year2023_team_PHI                                                    -7.2533e-02
year2023_team_PIT                                                    -4.6990e-02
year2023_team_TEN                                                    -2.3432e-02
year2023_team_ARI                                                    -2.3612e-01
year2023_team_CIN                                                    -1.6350e-01
year2023_team_DET                                                    -1.0969e-03
year2023_team_TB                                                      7.2479e-02
year2023_team_JAX                                                    -1.7029e-01
year2023_team_NYJ                                                     9.6089e-02
is_first_half                                                        -2.1238e-02
time_in_half                                                          1.2843e-02
GIMR                                                                  3.7112e-02
                                                                      Std. Error
(Intercept)                                                           4.3332e-01
ydstogo                                                               8.7278e-03
posteam_timeouts_remaining                                            9.2111e-03
defteam_timeouts_remaining                                            8.8833e-03
rush_attempt                                                          2.1285e-02
week                                                                  9.7572e-03
temp                                                                  1.0544e-02
wind                                                                  1.0559e-02
vegas_wp                                                              1.1012e-02
vegas_wp_posteam                                                      1.0042e-02
total_line                                                            1.2499e-02
prep_days                                                             7.8756e-03
overall_win_pct                                                       1.3109e-02
team_win_pct                                                          1.4207e-02
prev_shotgun_rate                                                     1.3714e-02
prev_singleback_rate                                                  1.3361e-02
prev_empty_rate                                                       1.0003e-02
prev_shotgun_success                                                  1.0650e-02
prev_singleback_success                                               1.0017e-02
prev_empty_success                                                    1.0505e-02
prev_stop_rate_run                                                    1.1457e-02
prev_stop_rate_pass                                                   1.0066e-02
shotgun_rate                                                          1.1558e-02
singleback_rate                                                       1.0827e-02
empty_rate                                                            1.0473e-02
shotgun_success                                                       8.8611e-03
singleback_success                                                    9.2726e-03
empty_success                                                         9.4571e-03
def_stop_rate_run                                                     9.2965e-03
def_stop_rate_pass                                                    9.1066e-03
avg_pass_rushers                                                      1.1230e-02
avg_box_defenders                                                     1.0807e-02
cover0_rate                                                           1.1478e-02
cover1_rate                                                           1.7948e-02
cover2_rate                                                           1.3362e-02
cover3_rate                                                           1.8377e-02
cover4_rate                                                           1.3562e-02
cover6_rate                                                           1.2212e-02
two_man_rate                                                          9.4552e-03
prevent_rate                                                          7.9492e-03
home_attendance                                                       2.2241e-02
roof_outdoors                                                         2.4278e-02
posteam_type_away                                                     1.7128e-02
offense_formation_EMPTY                                               3.8114e-02
offense_formation_SHOTGUN                                             3.1895e-02
offense_formation_SINGLEBACK                                          3.0838e-02
offense_player_1_present                                              1.7663e-01
offense_player_2_present                                              1.1844e-01
offense_player_4_present                                              6.8313e-02
offense_player_5_present                                              6.7772e-02
offense_player_6_present                                              2.6601e-01
offense_player_8_present                                              9.3006e-02
offense_player_9_present                                              1.3161e-01
offense_player_10_present                                             7.1197e-02
offense_player_11_present                                             9.0344e-02
offense_player_12_present                                             1.6679e-01
offense_player_14_present                                             9.2909e-02
offense_player_15_present                                             6.9434e-02
offense_player_16_present                                             7.4434e-02
offense_player_17_present                                             4.8938e-01
offense_player_20_present                                             3.2107e-01
offense_player_22_present                                             7.4231e-02
offense_player_23_present                                             1.3729e-01
offense_player_24_present                                             1.6913e-01
offense_player_9_receiving_concept_screen_grades_pass_route_12w       2.3202e-02
offense_player_9_receiving_depth_medium_yards_per_reception_12w       1.6331e-02
offense_player_9_receiving_grades_yprr_12w                            1.4444e-02
offense_player_9_blocking_grades_grades_offense_12w                   6.0347e-02
offense_player_9_run_blocking_zone_snap_counts_run_block_12w          1.3663e-02
offense_player_1_offense_blocking_grades_offense_3y                   9.7827e-03
offense_player_9_run_blocking_gap_grades_run_block_12w                3.6059e-02
offense_player_9_receiving_vs_scheme_zone_targets_percent_12w         1.2923e-02
offense_player_1_passing_concept_pa_grades_offense_12w                1.4068e-02
offense_player_1_passing_concept_pa_qb_rating_12w                     1.4600e-02
offense_player_9_receiving_concept_slot_grades_pass_route_12w         8.7804e-02
offense_player_9_blocking_grades_block_percent_12w                    1.6857e-02
offense_player_14_run_blocking_snap_counts_run_block_12w              9.2954e-03
offense_player_4_rushing_grades_first_downs_12w                       8.2916e-03
offense_player_8_blocking_grades_snap_counts_run_block_12w            1.0671e-02
offense_player_9_receiving_vs_scheme_man_pass_plays_12w               1.6115e-02
offense_player_9_receiving_grades_grades_offense_12w                  1.0426e-01
offense_player_14_pass_blocking_pass_block_percent_2w                 7.9163e-03
offense_player_9_receiving_depth_medium_longest_12w                   2.2917e-02
offense_player_9_receiving_depth_medium_receptions_12w                1.9956e-02
offense_player_9_receiving_vs_scheme_zone_route_rate_12w              4.6982e-02
defense_player_1_present                                              1.0412e-01
defense_player_2_present                                              4.6369e-02
defense_player_3_present                                              1.2309e-01
defense_player_4_present                                              3.2617e-02
defense_player_5_present                                              4.5815e-02
defense_player_6_present                                              8.2206e-02
defense_player_9_present                                              1.8856e-01
defense_player_10_present                                             3.8828e-02
defense_player_11_present                                             3.2033e-02
defense_player_12_present                                             3.2210e-02
defense_player_13_present                                             5.5008e-02
defense_player_14_present                                             2.1080e-01
defense_player_15_present                                             8.4101e-02
defense_player_16_present                                             4.2548e-02
defense_player_17_present                                             2.8744e-02
defense_player_18_present                                             3.7633e-02
defense_player_19_present                                             1.2329e-01
defense_player_20_present                                             8.9761e-02
defense_player_21_present                                             3.3013e-02
defense_player_22_present                                             2.9851e-02
defense_player_23_present                                             5.1947e-02
defense_player_3_defensive_grades_snap_counts_run_defense_12w         3.3039e-01
defense_player_3_defensive_grades_snap_counts_dl_b_gap_12w            1.2166e-02
defense_player_3_defensive_grades_grades_tackle_12w                   7.3590e-02
defense_player_3_run_defense_grades_grades_defense_12w                1.3520e-01
defense_player_3_run_defense_grades_grades_tackle_12w                 6.8867e-02
defense_player_3_run_defense_grades_tackles_12w                       3.2435e-02
defense_player_3_pass_rush_grades_grades_pass_rush_defense_12w        1.3424e-01
defense_player_3_pass_rushing_productivity_lhs_pass_rush_snaps_12w    2.9697e-02
defense_player_3_run_defense_grades_run_stop_opp_12w                  2.9548e-01
defense_player_3_defensive_grades_snap_counts_defense_12w             5.9915e-01
defense_player_3_pass_rush_grades_snap_counts_pass_play_12w           2.9742e-01
defense_player_3_run_defense_grades_snap_counts_run_12w               3.4833e-01
defense_player_3_defensive_grades_assists_12w                         1.1763e-02
defense_player_3_defense_summary_grades_defense_3y                    5.5674e-02
defense_player_3_defensive_grades_stops_12w                           3.3641e-02
defense_player_3_defensive_grades_snap_counts_pass_rush_12w           2.4208e-01
defense_player_3_defensive_grades_grades_run_defense_12w              1.2165e-01
defense_player_3_pass_rushing_productivity_pass_rush_percent_12w      1.4103e-01
defense_player_3_pass_rushing_productivity_lhs_pass_rush_percent_12w  2.8269e-02
defense_player_3_defense_summary_grades_run_defense_3y                5.4991e-02
defense_player_3_run_defense_grades_grades_defense_penalty_12w        3.4752e-02
defense_player_20_slot_coverage_coverage_snaps_12w                    8.2907e-03
defense_player_3_pass_rush_grades_pass_rush_wins_12w                  2.8261e-02
defense_player_3_defense_summary_snap_counts_pass_rush_3y             1.3351e-02
defense_player_3_run_defense_grades_stops_12w                         3.9026e-02
yardline_11_20                                                        3.1714e-02
yardline_21_30                                                        3.0641e-02
yardline_31_40                                                        2.7266e-02
yardline_41_50                                                        2.7558e-02
yardline_51_60                                                        3.1918e-02
yardline_61_70                                                        3.4852e-02
yardline_71_80                                                        4.2107e-02
yardline_81_90                                                        6.1511e-02
yardline_91_100                                                       1.0972e-01
year2017_team_BUF                                                     1.9169e-01
year2017_team_CHI                                                     1.6433e-01
year2017_team_CLE                                                     1.9249e-01
year2017_team_DAL                                                     1.6555e-01
year2017_team_DET                                                     1.7205e-01
year2017_team_GB                                                      1.6001e-01
year2017_team_HOU                                                     2.0798e-01
year2017_team_MIA                                                     1.7273e-01
year2017_team_MIN                                                     1.7921e-01
year2017_team_NE                                                      1.7828e-01
year2017_team_SF                                                      1.9448e-01
year2017_team_BAL                                                     1.9372e-01
year2017_team_DEN                                                     1.7907e-01
year2017_team_LA                                                      1.7844e-01
year2017_team_NYG                                                     1.6304e-01
year2017_team_OAK                                                     1.7626e-01
year2017_team_SEA                                                     1.7974e-01
year2017_team_CAR                                                     2.1553e-01
year2017_team_CIN                                                     2.0281e-01
year2017_team_IND                                                     1.7092e-01
year2017_team_NO                                                      2.0545e-01
year2017_team_PHI                                                     1.7772e-01
year2017_team_PIT                                                     1.7154e-01
year2017_team_TEN                                                     2.0753e-01
year2017_team_WAS                                                     1.8904e-01
year2017_team_KC                                                      1.8838e-01
year2017_team_LAC                                                     1.8701e-01
year2017_team_NYJ                                                     2.0734e-01
year2017_team_TB                                                      2.2538e-01
year2017_team_ATL                                                     1.8280e-01
year2017_team_JAX                                                     1.9000e-01
year2018_team_ARI                                                     2.1029e-01
year2018_team_BAL                                                     2.1281e-01
year2018_team_CAR                                                     2.1476e-01
year2018_team_CLE                                                     2.0655e-01
year2018_team_DET                                                     2.0116e-01
year2018_team_HOU                                                     2.1771e-01
year2018_team_IND                                                     2.0161e-01
year2018_team_KC                                                      2.0641e-01
year2018_team_NYG                                                     2.3416e-01
year2018_team_OAK                                                     2.1944e-01
year2018_team_PHI                                                     2.2096e-01
year2018_team_SEA                                                     2.3479e-01
year2018_team_BUF                                                     2.2199e-01
year2018_team_CHI                                                     1.9978e-01
year2018_team_CIN                                                     2.2861e-01
year2018_team_DAL                                                     2.1502e-01
year2018_team_DEN                                                     2.1144e-01
year2018_team_GB                                                      2.1782e-01
year2018_team_LAC                                                     2.1124e-01
year2018_team_NE                                                      2.2539e-01
year2018_team_NO                                                      2.0747e-01
year2018_team_PIT                                                     2.4964e-01
year2018_team_SF                                                      2.1184e-01
year2018_team_MIA                                                     2.0729e-01
year2018_team_MIN                                                     2.1514e-01
year2018_team_NYJ                                                     2.9020e-01
year2018_team_TB                                                      2.2683e-01
year2018_team_ATL                                                     2.0687e-01
year2018_team_JAX                                                     2.1663e-01
year2018_team_LA                                                      2.1648e-01
year2018_team_TEN                                                     2.2552e-01
year2018_team_WAS                                                     2.5357e-01
year2019_team_ARI                                                     2.2116e-01
year2019_team_BUF                                                     1.9965e-01
year2019_team_CHI                                                     2.0569e-01
year2019_team_CLE                                                     2.1346e-01
year2019_team_DAL                                                     2.2810e-01
year2019_team_IND                                                     2.0612e-01
year2019_team_JAX                                                     2.1229e-01
year2019_team_KC                                                      2.0287e-01
year2019_team_LAC                                                     2.0360e-01
year2019_team_MIN                                                     2.0786e-01
year2019_team_NE                                                      2.3072e-01
year2019_team_NO                                                      2.1747e-01
year2019_team_PHI                                                     2.1531e-01
year2019_team_SEA                                                     2.4973e-01
year2019_team_SF                                                      2.0596e-01
year2019_team_TB                                                      2.0706e-01
year2019_team_BAL                                                     2.0843e-01
year2019_team_CAR                                                     2.2971e-01
year2019_team_DEN                                                     2.0617e-01
year2019_team_DET                                                     2.1189e-01
year2019_team_HOU                                                     2.0938e-01
year2019_team_LA                                                      2.1953e-01
year2019_team_MIA                                                     2.2147e-01
year2019_team_NYG                                                     2.2184e-01
year2019_team_NYJ                                                     2.0100e-01
year2019_team_OAK                                                     2.1491e-01
year2019_team_PIT                                                     1.8806e-01
year2019_team_TEN                                                     2.0467e-01
year2019_team_CIN                                                     2.1052e-01
year2019_team_WAS                                                     2.1282e-01
year2019_team_ATL                                                     2.2278e-01
year2019_team_GB                                                      2.1365e-01
year2020_team_ATL                                                     2.1531e-01
year2020_team_BAL                                                     2.0976e-01
year2020_team_BUF                                                     2.3327e-01
year2020_team_CAR                                                     2.2162e-01
year2020_team_CIN                                                     2.0437e-01
year2020_team_DEN                                                     2.2318e-01
year2020_team_DET                                                     2.1182e-01
year2020_team_JAX                                                     2.1863e-01
year2020_team_KC                                                      2.1410e-01
year2020_team_LA                                                      2.2220e-01
year2020_team_MIN                                                     2.0415e-01
year2020_team_NE                                                      2.0949e-01
year2020_team_NO                                                      2.0604e-01
year2020_team_NYG                                                     2.1051e-01
year2020_team_SF                                                      2.2034e-01
year2020_team_WAS                                                     2.0891e-01
year2020_team_CHI                                                     2.2001e-01
year2020_team_DAL                                                     2.0780e-01
year2020_team_GB                                                      2.2642e-01
year2020_team_HOU                                                     2.1559e-01
year2020_team_MIA                                                     2.1908e-01
year2020_team_NYJ                                                     2.1781e-01
year2020_team_TB                                                      2.1775e-01
year2020_team_TEN                                                     2.2673e-01
year2020_team_ARI                                                     2.2611e-01
year2020_team_CLE                                                     2.3077e-01
year2020_team_IND                                                     2.2537e-01
year2020_team_LAC                                                     2.2789e-01
year2020_team_PHI                                                     2.0973e-01
year2020_team_SEA                                                     2.2406e-01
year2020_team_LV                                                      2.1108e-01
year2020_team_PIT                                                     2.2134e-01
year2021_team_ATL                                                     1.9802e-01
year2021_team_BUF                                                     1.9883e-01
year2021_team_CIN                                                     2.0325e-01
year2021_team_DAL                                                     2.0934e-01
year2021_team_DEN                                                     2.0228e-01
year2021_team_DET                                                     1.9656e-01
year2021_team_KC                                                      2.0002e-01
year2021_team_LA                                                      2.0248e-01
year2021_team_LV                                                      2.1017e-01
year2021_team_MIN                                                     1.9836e-01
year2021_team_NE                                                      2.0706e-01
year2021_team_NO                                                      2.0610e-01
year2021_team_NYG                                                     2.0448e-01
year2021_team_SF                                                      2.0693e-01
year2021_team_TEN                                                     1.9719e-01
year2021_team_ARI                                                     1.9688e-01
year2021_team_BAL                                                     2.3940e-01
year2021_team_CAR                                                     1.9340e-01
year2021_team_CHI                                                     1.9949e-01
year2021_team_GB                                                      1.9928e-01
year2021_team_IND                                                     2.0161e-01
year2021_team_LAC                                                     2.1039e-01
year2021_team_MIA                                                     2.1962e-01
year2021_team_NYJ                                                     2.1128e-01
year2021_team_PHI                                                     2.0158e-01
year2021_team_SEA                                                     2.1452e-01
year2021_team_TB                                                      2.1133e-01
year2021_team_WAS                                                     1.9763e-01
year2021_team_CLE                                                     1.9650e-01
year2021_team_HOU                                                     2.0786e-01
year2021_team_JAX                                                     2.0856e-01
year2021_team_PIT                                                     1.9795e-01
year2022_team_ARI                                                     1.9910e-01
year2022_team_ATL                                                     2.0344e-01
year2022_team_CAR                                                     2.1146e-01
year2022_team_CHI                                                     2.1082e-01
year2022_team_CIN                                                     2.1878e-01
year2022_team_HOU                                                     2.0157e-01
year2022_team_IND                                                     2.0174e-01
year2022_team_LAC                                                     2.0319e-01
year2022_team_MIA                                                     1.9558e-01
year2022_team_SEA                                                     2.0396e-01
year2022_team_TB                                                      1.9764e-01
year2022_team_TEN                                                     1.9384e-01
year2022_team_WAS                                                     1.9786e-01
year2022_team_BAL                                                     2.1499e-01
year2022_team_BUF                                                     2.0376e-01
year2022_team_DAL                                                     2.2676e-01
year2022_team_DET                                                     1.9775e-01
year2022_team_GB                                                      2.0107e-01
year2022_team_JAX                                                     1.9458e-01
year2022_team_KC                                                      2.3310e-01
year2022_team_LA                                                      1.9827e-01
year2022_team_LV                                                      2.1178e-01
year2022_team_NO                                                      2.1598e-01
year2022_team_PHI                                                     2.0333e-01
year2022_team_PIT                                                     1.9679e-01
year2022_team_CLE                                                     1.9194e-01
year2022_team_DEN                                                     1.9660e-01
year2022_team_MIN                                                     2.1280e-01
year2022_team_NE                                                      2.0804e-01
year2022_team_NYJ                                                     1.9737e-01
year2022_team_NYG                                                     2.0803e-01
year2022_team_SF                                                      2.2440e-01
year2023_team_BAL                                                     2.0386e-01
year2023_team_CHI                                                     2.0399e-01
year2023_team_CLE                                                     2.0200e-01
year2023_team_GB                                                      2.0167e-01
year2023_team_IND                                                     1.9475e-01
year2023_team_KC                                                      2.0178e-01
year2023_team_LAC                                                     2.0597e-01
year2023_team_LV                                                      1.9956e-01
year2023_team_MIA                                                     1.9916e-01
year2023_team_MIN                                                     1.9376e-01
year2023_team_NO                                                      2.1389e-01
year2023_team_NYG                                                     1.9617e-01
year2023_team_SEA                                                     1.9041e-01
year2023_team_SF                                                      2.2440e-01
year2023_team_WAS                                                     1.9789e-01
year2023_team_ATL                                                     2.0870e-01
year2023_team_BUF                                                     2.0709e-01
year2023_team_CAR                                                     1.9512e-01
year2023_team_DAL                                                     2.0624e-01
year2023_team_DEN                                                     1.9644e-01
year2023_team_HOU                                                     2.0422e-01
year2023_team_LA                                                      2.0587e-01
year2023_team_NE                                                      2.0366e-01
year2023_team_PHI                                                     2.0957e-01
year2023_team_PIT                                                     2.1689e-01
year2023_team_TEN                                                     2.0211e-01
year2023_team_ARI                                                     2.0303e-01
year2023_team_CIN                                                     2.1035e-01
year2023_team_DET                                                     1.9972e-01
year2023_team_TB                                                      2.0783e-01
year2023_team_JAX                                                     2.1642e-01
year2023_team_NYJ                                                     2.0017e-01
is_first_half                                                         1.7839e-02
time_in_half                                                          9.7763e-03
GIMR                                                                  2.4136e-02
                                                                      t value
(Intercept)                                                            1.6420
ydstogo                                                              -13.1196
posteam_timeouts_remaining                                             1.0547
defteam_timeouts_remaining                                             0.8867
rush_attempt                                                           7.1537
week                                                                   0.9748
temp                                                                  -0.4916
wind                                                                   0.9331
vegas_wp                                                               1.2855
vegas_wp_posteam                                                       0.7884
total_line                                                             2.2196
prep_days                                                              0.6837
overall_win_pct                                                       -0.0490
team_win_pct                                                           0.5086
prev_shotgun_rate                                                      1.0323
prev_singleback_rate                                                   0.5566
prev_empty_rate                                                        1.1191
prev_shotgun_success                                                  -1.5886
prev_singleback_success                                                0.8955
prev_empty_success                                                     0.5484
prev_stop_rate_run                                                     0.6555
prev_stop_rate_pass                                                   -3.1543
shotgun_rate                                                           1.7457
singleback_rate                                                        0.9359
empty_rate                                                             0.1163
shotgun_success                                                       -1.9629
singleback_success                                                    -1.2039
empty_success                                                         -0.5814
def_stop_rate_run                                                      1.8556
def_stop_rate_pass                                                    -1.1552
avg_pass_rushers                                                      -0.7756
avg_box_defenders                                                     -0.6214
cover0_rate                                                           -0.3640
cover1_rate                                                           -0.4938
cover2_rate                                                            0.0551
cover3_rate                                                            1.5333
cover4_rate                                                            1.4224
cover6_rate                                                           -0.2486
two_man_rate                                                           1.4649
prevent_rate                                                           2.6643
home_attendance                                                        0.1488
roof_outdoors                                                          0.1366
posteam_type_away                                                      0.8328
offense_formation_EMPTY                                                0.7712
offense_formation_SHOTGUN                                              0.1955
offense_formation_SINGLEBACK                                           0.1526
offense_player_1_present                                               2.8061
offense_player_2_present                                              -1.3049
offense_player_4_present                                               0.0077
offense_player_5_present                                              -0.1181
offense_player_6_present                                              -0.7144
offense_player_8_present                                              -2.7617
offense_player_9_present                                              -2.5218
offense_player_10_present                                             -0.3783
offense_player_11_present                                             -0.8056
offense_player_12_present                                              3.1040
offense_player_14_present                                             -0.2455
offense_player_15_present                                             -1.0077
offense_player_16_present                                             -0.7714
offense_player_17_present                                             -0.7471
offense_player_20_present                                              0.2296
offense_player_22_present                                             -1.2824
offense_player_23_present                                              1.2449
offense_player_24_present                                             -5.8548
offense_player_9_receiving_concept_screen_grades_pass_route_12w       -2.2520
offense_player_9_receiving_depth_medium_yards_per_reception_12w       -3.1429
offense_player_9_receiving_grades_yprr_12w                            -0.7134
offense_player_9_blocking_grades_grades_offense_12w                    1.7622
offense_player_9_run_blocking_zone_snap_counts_run_block_12w           1.4796
offense_player_1_offense_blocking_grades_offense_3y                    1.2250
offense_player_9_run_blocking_gap_grades_run_block_12w                 1.7094
offense_player_9_receiving_vs_scheme_zone_targets_percent_12w         -0.7052
offense_player_1_passing_concept_pa_grades_offense_12w                 0.1124
offense_player_1_passing_concept_pa_qb_rating_12w                      0.7795
offense_player_9_receiving_concept_slot_grades_pass_route_12w          0.0471
offense_player_9_blocking_grades_block_percent_12w                    -2.1903
offense_player_14_run_blocking_snap_counts_run_block_12w               0.5496
offense_player_4_rushing_grades_first_downs_12w                        0.6475
offense_player_8_blocking_grades_snap_counts_run_block_12w             2.0264
offense_player_9_receiving_vs_scheme_man_pass_plays_12w               -1.0012
offense_player_9_receiving_grades_grades_offense_12w                  -0.4653
offense_player_14_pass_blocking_pass_block_percent_2w                  1.8994
offense_player_9_receiving_depth_medium_longest_12w                    1.1609
offense_player_9_receiving_depth_medium_receptions_12w                -1.8781
offense_player_9_receiving_vs_scheme_zone_route_rate_12w               2.2762
defense_player_1_present                                              -1.7159
defense_player_2_present                                               1.7801
defense_player_3_present                                               0.3921
defense_player_4_present                                              -0.9780
defense_player_5_present                                              -1.2405
defense_player_6_present                                              -0.6055
defense_player_9_present                                               0.4215
defense_player_10_present                                             -0.1252
defense_player_11_present                                             -0.4657
defense_player_12_present                                             -0.2051
defense_player_13_present                                              2.2932
defense_player_14_present                                              0.4758
defense_player_15_present                                              0.6578
defense_player_16_present                                              0.0960
defense_player_17_present                                              0.4210
defense_player_18_present                                              1.3827
defense_player_19_present                                              0.6645
defense_player_20_present                                             -0.7553
defense_player_21_present                                              1.3994
defense_player_22_present                                              0.9253
defense_player_23_present                                              1.0561
defense_player_3_defensive_grades_snap_counts_run_defense_12w         -0.2383
defense_player_3_defensive_grades_snap_counts_dl_b_gap_12w            -0.7433
defense_player_3_defensive_grades_grades_tackle_12w                    3.7456
defense_player_3_run_defense_grades_grades_defense_12w                 0.5346
defense_player_3_run_defense_grades_grades_tackle_12w                 -3.5316
defense_player_3_run_defense_grades_tackles_12w                        1.2926
defense_player_3_pass_rush_grades_grades_pass_rush_defense_12w        -0.3013
defense_player_3_pass_rushing_productivity_lhs_pass_rush_snaps_12w    -0.4915
defense_player_3_run_defense_grades_run_stop_opp_12w                   0.0658
defense_player_3_defensive_grades_snap_counts_defense_12w              0.6241
defense_player_3_pass_rush_grades_snap_counts_pass_play_12w           -0.6631
defense_player_3_run_defense_grades_snap_counts_run_12w               -0.1051
defense_player_3_defensive_grades_assists_12w                         -0.4086
defense_player_3_defense_summary_grades_defense_3y                     1.4131
defense_player_3_defensive_grades_stops_12w                           -1.6891
defense_player_3_defensive_grades_snap_counts_pass_rush_12w           -0.2358
defense_player_3_defensive_grades_grades_run_defense_12w              -0.8215
defense_player_3_pass_rushing_productivity_pass_rush_percent_12w      -0.1938
defense_player_3_pass_rushing_productivity_lhs_pass_rush_percent_12w   1.0568
defense_player_3_defense_summary_grades_run_defense_3y                -0.7264
defense_player_3_run_defense_grades_grades_defense_penalty_12w         0.3696
defense_player_20_slot_coverage_coverage_snaps_12w                     1.7617
defense_player_3_pass_rush_grades_pass_rush_wins_12w                   0.6381
defense_player_3_defense_summary_snap_counts_pass_rush_3y             -1.8032
defense_player_3_run_defense_grades_stops_12w                         -0.1095
yardline_11_20                                                         2.4103
yardline_21_30                                                         2.1969
yardline_31_40                                                         2.4675
yardline_41_50                                                         3.9913
yardline_51_60                                                         2.4631
yardline_61_70                                                         3.1607
yardline_71_80                                                         3.2355
yardline_81_90                                                         3.1384
yardline_91_100                                                        1.2789
year2017_team_BUF                                                     -0.8235
year2017_team_CHI                                                      0.2850
year2017_team_CLE                                                      1.1087
year2017_team_DAL                                                     -1.0433
year2017_team_DET                                                     -0.4519
year2017_team_GB                                                       2.1730
year2017_team_HOU                                                      1.3076
year2017_team_MIA                                                     -1.3769
year2017_team_MIN                                                     -0.7183
year2017_team_NE                                                      -0.2658
year2017_team_SF                                                       1.5403
year2017_team_BAL                                                      0.1873
year2017_team_DEN                                                     -0.0082
year2017_team_LA                                                       0.1537
year2017_team_NYG                                                     -0.7241
year2017_team_OAK                                                     -0.9391
year2017_team_SEA                                                      0.6201
year2017_team_CAR                                                      0.4303
year2017_team_CIN                                                      0.8944
year2017_team_IND                                                      0.8549
year2017_team_NO                                                       0.7701
year2017_team_PHI                                                      0.5207
year2017_team_PIT                                                     -0.9603
year2017_team_TEN                                                     -0.1654
year2017_team_WAS                                                      0.2686
year2017_team_KC                                                       1.2359
year2017_team_LAC                                                     -0.3689
year2017_team_NYJ                                                      0.6923
year2017_team_TB                                                       0.0888
year2017_team_ATL                                                      0.0005
year2017_team_JAX                                                      0.4125
year2018_team_ARI                                                     -0.1403
year2018_team_BAL                                                      0.1582
year2018_team_CAR                                                      0.1126
year2018_team_CLE                                                     -0.2546
year2018_team_DET                                                      0.3065
year2018_team_HOU                                                      0.6023
year2018_team_IND                                                     -0.5623
year2018_team_KC                                                       0.3999
year2018_team_NYG                                                      0.4431
year2018_team_OAK                                                     -0.5108
year2018_team_PHI                                                      0.1322
year2018_team_SEA                                                     -0.5988
year2018_team_BUF                                                     -0.5507
year2018_team_CHI                                                     -0.1425
year2018_team_CIN                                                     -0.5696
year2018_team_DAL                                                     -0.3536
year2018_team_DEN                                                     -0.1700
year2018_team_GB                                                      -0.3436
year2018_team_LAC                                                     -0.1021
year2018_team_NE                                                      -0.3235
year2018_team_NO                                                       0.4136
year2018_team_PIT                                                      0.4369
year2018_team_SF                                                       0.3723
year2018_team_MIA                                                      0.1234
year2018_team_MIN                                                     -0.1411
year2018_team_NYJ                                                      0.4740
year2018_team_TB                                                       0.4279
year2018_team_ATL                                                      0.3172
year2018_team_JAX                                                     -0.1656
year2018_team_LA                                                      -0.9144
year2018_team_TEN                                                      0.3921
year2018_team_WAS                                                     -0.0555
year2019_team_ARI                                                     -0.4120
year2019_team_BUF                                                     -0.6342
year2019_team_CHI                                                      0.2064
year2019_team_CLE                                                      0.4692
year2019_team_DAL                                                     -0.4127
year2019_team_IND                                                     -0.5317
year2019_team_JAX                                                      0.2227
year2019_team_KC                                                      -0.0935
year2019_team_LAC                                                     -0.7583
year2019_team_MIN                                                     -0.7061
year2019_team_NE                                                       0.1646
year2019_team_NO                                                      -0.8930
year2019_team_PHI                                                     -0.1308
year2019_team_SEA                                                     -0.0478
year2019_team_SF                                                      -0.1148
year2019_team_TB                                                      -0.2691
year2019_team_BAL                                                      0.0763
year2019_team_CAR                                                     -0.3930
year2019_team_DEN                                                      0.3540
year2019_team_DET                                                     -0.7092
year2019_team_HOU                                                     -0.3982
year2019_team_LA                                                      -0.7301
year2019_team_MIA                                                     -1.2091
year2019_team_NYG                                                     -0.5950
year2019_team_NYJ                                                     -1.2381
year2019_team_OAK                                                     -0.5016
year2019_team_PIT                                                     -1.5804
year2019_team_TEN                                                     -0.8005
year2019_team_CIN                                                      0.4444
year2019_team_WAS                                                     -0.4648
year2019_team_ATL                                                     -0.0373
year2019_team_GB                                                      -0.4926
year2020_team_ATL                                                      0.1003
year2020_team_BAL                                                      0.3975
year2020_team_BUF                                                      0.0053
year2020_team_CAR                                                      0.4675
year2020_team_CIN                                                      0.8548
year2020_team_DEN                                                     -0.3940
year2020_team_DET                                                     -0.6371
year2020_team_JAX                                                     -0.5353
year2020_team_KC                                                       0.3035
year2020_team_LA                                                      -0.9234
year2020_team_MIN                                                      0.5438
year2020_team_NE                                                      -0.4209
year2020_team_NO                                                       0.0447
year2020_team_NYG                                                     -0.0871
year2020_team_SF                                                      -0.0846
year2020_team_WAS                                                     -0.0447
year2020_team_CHI                                                     -0.0939
year2020_team_DAL                                                     -0.1041
year2020_team_GB                                                      -0.2137
year2020_team_HOU                                                     -0.4321
year2020_team_MIA                                                     -0.7083
year2020_team_NYJ                                                     -0.0723
year2020_team_TB                                                       0.4069
year2020_team_TEN                                                     -0.3528
year2020_team_ARI                                                      0.4079
year2020_team_CLE                                                     -0.9955
year2020_team_IND                                                     -0.3642
year2020_team_LAC                                                      0.2662
year2020_team_PHI                                                      0.3803
year2020_team_SEA                                                     -0.2715
year2020_team_LV                                                       0.4942
year2020_team_PIT                                                     -0.4851
year2021_team_ATL                                                     -0.9443
year2021_team_BUF                                                      0.3096
year2021_team_CIN                                                     -0.9321
year2021_team_DAL                                                     -0.2533
year2021_team_DEN                                                      0.0649
year2021_team_DET                                                     -0.3834
year2021_team_KC                                                       0.0279
year2021_team_LA                                                      -0.4540
year2021_team_LV                                                       0.1939
year2021_team_MIN                                                     -0.3421
year2021_team_NE                                                       0.3150
year2021_team_NO                                                      -0.2106
year2021_team_NYG                                                      0.1432
year2021_team_SF                                                      -0.1363
year2021_team_TEN                                                     -0.3782
year2021_team_ARI                                                      0.2716
year2021_team_BAL                                                      0.4715
year2021_team_CAR                                                     -0.4850
year2021_team_CHI                                                     -1.2949
year2021_team_GB                                                       0.3366
year2021_team_IND                                                     -0.3506
year2021_team_LAC                                                     -0.0132
year2021_team_MIA                                                      0.1441
year2021_team_NYJ                                                     -0.0686
year2021_team_PHI                                                     -0.8865
year2021_team_SEA                                                     -1.0654
year2021_team_TB                                                       0.0555
year2021_team_WAS                                                     -0.7079
year2021_team_CLE                                                     -0.7099
year2021_team_HOU                                                     -0.0610
year2021_team_JAX                                                     -0.1106
year2021_team_PIT                                                     -0.2452
year2022_team_ARI                                                     -1.2360
year2022_team_ATL                                                     -1.5004
year2022_team_CAR                                                      0.2779
year2022_team_CHI                                                     -0.5047
year2022_team_CIN                                                     -0.6137
year2022_team_HOU                                                     -0.4842
year2022_team_IND                                                     -0.5770
year2022_team_LAC                                                     -0.5322
year2022_team_MIA                                                     -0.9186
year2022_team_SEA                                                     -0.2233
year2022_team_TB                                                       0.0190
year2022_team_TEN                                                      0.5232
year2022_team_WAS                                                     -0.3530
year2022_team_BAL                                                     -1.1180
year2022_team_BUF                                                      0.4248
year2022_team_DAL                                                     -0.0876
year2022_team_DET                                                     -0.4652
year2022_team_GB                                                      -0.8175
year2022_team_JAX                                                     -0.8190
year2022_team_KC                                                      -0.5685
year2022_team_LA                                                       0.5192
year2022_team_LV                                                       0.3950
year2022_team_NO                                                      -0.3220
year2022_team_PHI                                                      0.2997
year2022_team_PIT                                                      0.5998
year2022_team_CLE                                                     -0.1316
year2022_team_DEN                                                     -0.0535
year2022_team_MIN                                                     -0.5615
year2022_team_NE                                                       0.0531
year2022_team_NYJ                                                     -0.7051
year2022_team_NYG                                                     -0.5009
year2022_team_SF                                                      -1.0406
year2023_team_BAL                                                     -0.5903
year2023_team_CHI                                                     -0.9548
year2023_team_CLE                                                     -1.0109
year2023_team_GB                                                       0.0176
year2023_team_IND                                                      0.0939
year2023_team_KC                                                      -0.0207
year2023_team_LAC                                                      0.0325
year2023_team_LV                                                       0.0483
year2023_team_MIA                                                      0.1705
year2023_team_MIN                                                      0.5348
year2023_team_NO                                                      -0.4119
year2023_team_NYG                                                      0.2349
year2023_team_SEA                                                     -1.3060
year2023_team_SF                                                       0.0606
year2023_team_WAS                                                      0.3609
year2023_team_ATL                                                     -0.8703
year2023_team_BUF                                                     -0.5252
year2023_team_CAR                                                      0.0198
year2023_team_DAL                                                      0.1620
year2023_team_DEN                                                     -0.1884
year2023_team_HOU                                                     -0.0136
year2023_team_LA                                                       0.1101
year2023_team_NE                                                      -0.2449
year2023_team_PHI                                                     -0.3461
year2023_team_PIT                                                     -0.2167
year2023_team_TEN                                                     -0.1159
year2023_team_ARI                                                     -1.1630
year2023_team_CIN                                                     -0.7773
year2023_team_DET                                                     -0.0055
year2023_team_TB                                                       0.3487
year2023_team_JAX                                                     -0.7869
year2023_team_NYJ                                                      0.4800
is_first_half                                                         -1.1905
time_in_half                                                           1.3137
GIMR                                                                   1.5376
                                                                      Pr(&gt;|t|)
(Intercept)                                                          0.1006849
ydstogo                                                              &lt; 2.2e-16
posteam_timeouts_remaining                                           0.2916419
defteam_timeouts_remaining                                           0.3752895
rush_attempt                                                         1.016e-12
week                                                                 0.3297293
temp                                                                 0.6230160
wind                                                                 0.3508260
vegas_wp                                                             0.1987065
vegas_wp_posteam                                                     0.4305288
total_line                                                           0.0265100
prep_days                                                            0.4942341
overall_win_pct                                                      0.9609521
team_win_pct                                                         0.6110699
prev_shotgun_rate                                                    0.3019813
prev_singleback_rate                                                 0.5778074
prev_empty_rate                                                      0.2631882
prev_shotgun_success                                                 0.1122460
prev_singleback_success                                              0.3705642
prev_empty_success                                                   0.5834759
prev_stop_rate_run                                                   0.5122064
prev_stop_rate_pass                                                  0.0016221
shotgun_rate                                                         0.0809427
singleback_rate                                                      0.3493801
empty_rate                                                           0.9074348
shotgun_success                                                      0.0497386
singleback_success                                                   0.2287105
empty_success                                                        0.5609772
def_stop_rate_run                                                    0.0635953
def_stop_rate_pass                                                   0.2480760
avg_pass_rushers                                                     0.4380227
avg_box_defenders                                                    0.5343693
cover0_rate                                                          0.7158962
cover1_rate                                                          0.6214920
cover2_rate                                                          0.9560489
cover3_rate                                                          0.1252996
cover4_rate                                                          0.1549965
cover6_rate                                                          0.8036948
two_man_rate                                                         0.1430476
prevent_rate                                                         0.0077481
home_attendance                                                      0.8817108
roof_outdoors                                                        0.8913279
posteam_type_away                                                    0.4050186
offense_formation_EMPTY                                              0.4406292
offense_formation_SHOTGUN                                            0.8449850
offense_formation_SINGLEBACK                                         0.8787492
offense_player_1_present                                             0.0050409
offense_player_2_present                                             0.1920180
offense_player_4_present                                             0.9938275
offense_player_5_present                                             0.9060251
offense_player_6_present                                             0.4750085
offense_player_8_present                                             0.0057795
offense_player_9_present                                             0.0117185
offense_player_10_present                                            0.7051948
offense_player_11_present                                            0.4205377
offense_player_12_present                                            0.0019240
offense_player_14_present                                            0.8061066
offense_player_15_present                                            0.3136688
offense_player_16_present                                            0.4405126
offense_player_17_present                                            0.4550756
offense_player_20_present                                            0.8183973
offense_player_22_present                                            0.1997774
offense_player_23_present                                            0.2132404
offense_player_24_present                                            5.197e-09
offense_player_9_receiving_concept_screen_grades_pass_route_12w      0.0243844
offense_player_9_receiving_depth_medium_yards_per_reception_12w      0.0016865
offense_player_9_receiving_grades_yprr_12w                           0.4756700
offense_player_9_blocking_grades_grades_offense_12w                  0.0781193
offense_player_9_run_blocking_zone_snap_counts_run_block_12w         0.1390791
offense_player_1_offense_blocking_grades_offense_3y                  0.2206642
offense_player_9_run_blocking_gap_grades_run_block_12w               0.0874622
offense_player_9_receiving_vs_scheme_zone_targets_percent_12w        0.4807101
offense_player_1_passing_concept_pa_grades_offense_12w               0.9105055
offense_player_1_passing_concept_pa_qb_rating_12w                    0.4357573
offense_player_9_receiving_concept_slot_grades_pass_route_12w        0.9624759
offense_player_9_blocking_grades_block_percent_12w                   0.0285674
offense_player_14_run_blocking_snap_counts_run_block_12w             0.5826286
offense_player_4_rushing_grades_first_downs_12w                      0.5173762
offense_player_8_blocking_grades_snap_counts_run_block_12w           0.0427951
offense_player_9_receiving_vs_scheme_man_pass_plays_12w              0.3167815
offense_player_9_receiving_grades_grades_offense_12w                 0.6417641
offense_player_14_pass_blocking_pass_block_percent_2w                0.0575924
offense_player_9_receiving_depth_medium_longest_12w                  0.2457519
offense_player_9_receiving_depth_medium_receptions_12w               0.0604467
offense_player_9_receiving_vs_scheme_zone_route_rate_12w             0.0228935
defense_player_1_present                                             0.0862667
defense_player_2_present                                             0.0751433
defense_player_3_present                                             0.6950305
defense_player_4_present                                             0.3281273
defense_player_5_present                                             0.2148764
defense_player_6_present                                             0.5448816
defense_player_9_present                                             0.6734323
defense_player_10_present                                            0.9003767
defense_player_11_present                                            0.6414382
defense_player_12_present                                            0.8375021
defense_player_13_present                                            0.0218950
defense_player_14_present                                            0.6342235
defense_player_15_present                                            0.5106765
defense_player_16_present                                            0.9235483
defense_player_17_present                                            0.6737601
defense_player_18_present                                            0.1668366
defense_player_19_present                                            0.5064221
defense_player_20_present                                            0.4501086
defense_player_21_present                                            0.1617883
defense_player_22_present                                            0.3548767
defense_player_23_present                                            0.2910026
defense_player_3_defensive_grades_snap_counts_run_defense_12w        0.8116298
defense_player_3_defensive_grades_snap_counts_dl_b_gap_12w           0.4573459
defense_player_3_defensive_grades_grades_tackle_12w                  0.0001827
defense_player_3_run_defense_grades_grades_defense_12w               0.5929491
defense_player_3_run_defense_grades_grades_tackle_12w                0.0004181
defense_player_3_run_defense_grades_tackles_12w                      0.1962211
defense_player_3_pass_rush_grades_grades_pass_rush_defense_12w       0.7632311
defense_player_3_pass_rushing_productivity_lhs_pass_rush_snaps_12w   0.6231038
defense_player_3_run_defense_grades_run_stop_opp_12w                 0.9475053
defense_player_3_defensive_grades_snap_counts_defense_12w            0.5326158
defense_player_3_pass_rush_grades_snap_counts_pass_play_12w          0.5072847
defense_player_3_run_defense_grades_snap_counts_run_12w              0.9162646
defense_player_3_defensive_grades_assists_12w                        0.6828725
defense_player_3_defense_summary_grades_defense_3y                   0.1577185
defense_player_3_defensive_grades_stops_12w                          0.0912826
defense_player_3_defensive_grades_snap_counts_pass_rush_12w          0.8136123
defense_player_3_defensive_grades_grades_run_defense_12w             0.4114016
defense_player_3_pass_rushing_productivity_pass_rush_percent_12w     0.8463324
defense_player_3_pass_rushing_productivity_lhs_pass_rush_percent_12w 0.2906578
defense_player_3_defense_summary_grades_run_defense_3y               0.4676506
defense_player_3_run_defense_grades_grades_defense_penalty_12w       0.7116953
defense_player_20_slot_coverage_coverage_snaps_12w                   0.0782025
defense_player_3_pass_rush_grades_pass_rush_wins_12w                 0.5234217
defense_player_3_defense_summary_snap_counts_pass_rush_3y            0.0714394
defense_player_3_run_defense_grades_stops_12w                        0.9128145
yardline_11_20                                                       0.0159899
yardline_21_30                                                       0.0280874
yardline_31_40                                                       0.0136532
yardline_41_50                                                       6.701e-05
yardline_51_60                                                       0.0138218
yardline_61_70                                                       0.0015868
yardline_71_80                                                       0.0012250
yardline_81_90                                                       0.0017122
yardline_91_100                                                      0.2010033
year2017_team_BUF                                                    0.4102687
year2017_team_CHI                                                    0.7756284
year2017_team_CLE                                                    0.2676216
year2017_team_DAL                                                    0.2968728
year2017_team_DET                                                    0.6513644
year2017_team_GB                                                     0.0298464
year2017_team_HOU                                                    0.1910748
year2017_team_MIA                                                    0.1686253
year2017_team_MIN                                                    0.4726001
year2017_team_NE                                                     0.7904368
year2017_team_SF                                                     0.1235727
year2017_team_BAL                                                    0.8514693
year2017_team_DEN                                                    0.9934880
year2017_team_LA                                                     0.8778272
year2017_team_NYG                                                    0.4690446
year2017_team_OAK                                                    0.3477175
year2017_team_SEA                                                    0.5352582
year2017_team_CAR                                                    0.6670006
year2017_team_CIN                                                    0.3711825
year2017_team_IND                                                    0.3926487
year2017_team_NO                                                     0.4412875
year2017_team_PHI                                                    0.6026345
year2017_team_PIT                                                    0.3369563
year2017_team_TEN                                                    0.8686340
year2017_team_WAS                                                    0.7882707
year2017_team_KC                                                     0.2165822
year2017_team_LAC                                                    0.7122165
year2017_team_NYJ                                                    0.4888204
year2017_team_TB                                                     0.9292590
year2017_team_ATL                                                    0.9996202
year2017_team_JAX                                                    0.6799750
year2018_team_ARI                                                    0.8884014
year2018_team_BAL                                                    0.8742768
year2018_team_CAR                                                    0.9103512
year2018_team_CLE                                                    0.7990543
year2018_team_DET                                                    0.7592597
year2018_team_HOU                                                    0.5470113
year2018_team_IND                                                    0.5739483
year2018_team_KC                                                     0.6892509
year2018_team_NYG                                                    0.6577443
year2018_team_OAK                                                    0.6094874
year2018_team_PHI                                                    0.8948192
year2018_team_SEA                                                    0.5493710
year2018_team_BUF                                                    0.5818460
year2018_team_CHI                                                    0.8866842
year2018_team_CIN                                                    0.5690152
year2018_team_DAL                                                    0.7236415
year2018_team_DEN                                                    0.8650531
year2018_team_GB                                                     0.7311815
year2018_team_LAC                                                    0.9186920
year2018_team_NE                                                     0.7463506
year2018_team_NO                                                     0.6792219
year2018_team_PIT                                                    0.6622034
year2018_team_SF                                                     0.7096578
year2018_team_MIA                                                    0.9017852
year2018_team_MIN                                                    0.8878061
year2018_team_NYJ                                                    0.6355321
year2018_team_TB                                                     0.6687393
year2018_team_ATL                                                    0.7511194
year2018_team_JAX                                                    0.8684758
year2018_team_LA                                                     0.3605641
year2018_team_TEN                                                    0.6949897
year2018_team_WAS                                                    0.9557551
year2019_team_ARI                                                    0.6803429
year2019_team_BUF                                                    0.5260081
year2019_team_CHI                                                    0.8365237
year2019_team_CLE                                                    0.6389838
year2019_team_DAL                                                    0.6798261
year2019_team_IND                                                    0.5949615
year2019_team_JAX                                                    0.8237680
year2019_team_KC                                                     0.9255082
year2019_team_LAC                                                    0.4483364
year2019_team_MIN                                                    0.4802000
year2019_team_NE                                                     0.8693043
year2019_team_NO                                                     0.3719264
year2019_team_PHI                                                    0.8959452
year2019_team_SEA                                                    0.9619115
year2019_team_SF                                                     0.9086161
year2019_team_TB                                                     0.7878373
year2019_team_BAL                                                    0.9391896
year2019_team_CAR                                                    0.6943331
year2019_team_DEN                                                    0.7233610
year2019_team_DET                                                    0.4782230
year2019_team_HOU                                                    0.6905008
year2019_team_LA                                                     0.4653547
year2019_team_MIA                                                    0.2267128
year2019_team_NYG                                                    0.5518733
year2019_team_NYJ                                                    0.2157718
year2019_team_OAK                                                    0.6159973
year2019_team_PIT                                                    0.1141114
year2019_team_TEN                                                    0.4234838
year2019_team_CIN                                                    0.6567955
year2019_team_WAS                                                    0.6421185
year2019_team_ATL                                                    0.9702103
year2019_team_GB                                                     0.6223030
year2020_team_ATL                                                    0.9201484
year2020_team_BAL                                                    0.6910163
year2020_team_BUF                                                    0.9957925
year2020_team_CAR                                                    0.6401732
year2020_team_CIN                                                    0.3927183
year2020_team_DEN                                                    0.6936348
year2020_team_DET                                                    0.5240922
year2020_team_JAX                                                    0.5924803
year2020_team_KC                                                     0.7615258
year2020_team_LA                                                     0.3558738
year2020_team_MIN                                                    0.5866368
year2020_team_NE                                                     0.6738398
year2020_team_NO                                                     0.9643562
year2020_team_NYG                                                    0.9306170
year2020_team_SF                                                     0.9326005
year2020_team_WAS                                                    0.9643470
year2020_team_CHI                                                    0.9251940
year2020_team_DAL                                                    0.9171152
year2020_team_GB                                                     0.8308159
year2020_team_HOU                                                    0.6656777
year2020_team_MIA                                                    0.4788221
year2020_team_NYJ                                                    0.9423289
year2020_team_TB                                                     0.6840884
year2020_team_TEN                                                    0.7242714
year2020_team_ARI                                                    0.6833804
year2020_team_CLE                                                    0.3195548
year2020_team_IND                                                    0.7156986
year2020_team_LAC                                                    0.7900868
year2020_team_PHI                                                    0.7037223
year2020_team_SEA                                                    0.7860221
year2020_team_LV                                                     0.6212176
year2020_team_PIT                                                    0.6276464
year2021_team_ATL                                                    0.3450752
year2021_team_BUF                                                    0.7568988
year2021_team_CIN                                                    0.3513304
year2021_team_DAL                                                    0.8000686
year2021_team_DEN                                                    0.9482384
year2021_team_DET                                                    0.7014479
year2021_team_KC                                                     0.9777442
year2021_team_LA                                                     0.6498572
year2021_team_LV                                                     0.8463032
year2021_team_MIN                                                    0.7323274
year2021_team_NE                                                     0.7528098
year2021_team_NO                                                     0.8331727
year2021_team_NYG                                                    0.8861511
year2021_team_SF                                                     0.8915858
year2021_team_TEN                                                    0.7052794
year2021_team_ARI                                                    0.7859796
year2021_team_BAL                                                    0.6372956
year2021_team_CAR                                                    0.6277377
year2021_team_CHI                                                    0.1954262
year2021_team_GB                                                     0.7364558
year2021_team_IND                                                    0.7259178
year2021_team_LAC                                                    0.9894709
year2021_team_MIA                                                    0.8854293
year2021_team_NYJ                                                    0.9452958
year2021_team_PHI                                                    0.3754058
year2021_team_SEA                                                    0.2867789
year2021_team_TB                                                     0.9557090
year2021_team_WAS                                                    0.4790480
year2021_team_CLE                                                    0.4778167
year2021_team_HOU                                                    0.9513485
year2021_team_JAX                                                    0.9119656
year2021_team_PIT                                                    0.8063261
year2022_team_ARI                                                    0.2165435
year2022_team_ATL                                                    0.1335921
year2022_team_CAR                                                    0.7810754
year2022_team_CHI                                                    0.6137850
year2022_team_CIN                                                    0.5394382
year2022_team_HOU                                                    0.6282872
year2022_team_IND                                                    0.5639861
year2022_team_LAC                                                    0.5946186
year2022_team_MIA                                                    0.3583482
year2022_team_SEA                                                    0.8233335
year2022_team_TB                                                     0.9848133
year2022_team_TEN                                                    0.6008633
year2022_team_WAS                                                    0.7241294
year2022_team_BAL                                                    0.2636552
year2022_team_BUF                                                    0.6709892
year2022_team_DAL                                                    0.9302213
year2022_team_DET                                                    0.6418464
year2022_team_GB                                                     0.4136976
year2022_team_JAX                                                    0.4128133
year2022_team_KC                                                     0.5697337
year2022_team_LA                                                     0.6036598
year2022_team_LV                                                     0.6928740
year2022_team_NO                                                     0.7474390
year2022_team_PHI                                                    0.7643853
year2022_team_PIT                                                    0.5486933
year2022_team_CLE                                                    0.8953446
year2022_team_DEN                                                    0.9573352
year2022_team_MIN                                                    0.5745077
year2022_team_NE                                                     0.9576461
year2022_team_NYJ                                                    0.4807645
year2022_team_NYG                                                    0.6164992
year2022_team_SF                                                     0.2981176
year2023_team_BAL                                                    0.5550458
year2023_team_CHI                                                    0.3397389
year2023_team_CLE                                                    0.3121216
year2023_team_GB                                                     0.9859497
year2023_team_IND                                                    0.9252032
year2023_team_KC                                                     0.9834855
year2023_team_LAC                                                    0.9740552
year2023_team_LV                                                     0.9615134
year2023_team_MIA                                                    0.8646164
year2023_team_MIN                                                    0.5928171
year2023_team_NO                                                     0.6804286
year2023_team_NYG                                                    0.8143253
year2023_team_SEA                                                    0.1916399
year2023_team_SF                                                     0.9516616
year2023_team_WAS                                                    0.7182305
year2023_team_ATL                                                    0.3842169
year2023_team_BUF                                                    0.5994422
year2023_team_CAR                                                    0.9842237
year2023_team_DAL                                                    0.8713013
year2023_team_DEN                                                    0.8505513
year2023_team_HOU                                                    0.9891630
year2023_team_LA                                                     0.9123451
year2023_team_NE                                                     0.8065341
year2023_team_PHI                                                    0.7292811
year2023_team_PIT                                                    0.8284927
year2023_team_TEN                                                    0.9077106
year2023_team_ARI                                                    0.2448972
year2023_team_CIN                                                    0.4370304
year2023_team_DET                                                    0.9956181
year2023_team_TB                                                     0.7273059
year2023_team_JAX                                                    0.4314168
year2023_team_NYJ                                                    0.6312250
is_first_half                                                        0.2339214
time_in_half                                                         0.1890370
GIMR                                                                 0.1242343
                                                                        
(Intercept)                                                             
ydstogo                                                              ***
posteam_timeouts_remaining                                              
defteam_timeouts_remaining                                              
rush_attempt                                                         ***
week                                                                    
temp                                                                    
wind                                                                    
vegas_wp                                                                
vegas_wp_posteam                                                        
total_line                                                           *  
prep_days                                                               
overall_win_pct                                                         
team_win_pct                                                            
prev_shotgun_rate                                                       
prev_singleback_rate                                                    
prev_empty_rate                                                         
prev_shotgun_success                                                    
prev_singleback_success                                                 
prev_empty_success                                                      
prev_stop_rate_run                                                      
prev_stop_rate_pass                                                  ** 
shotgun_rate                                                         .  
singleback_rate                                                         
empty_rate                                                              
shotgun_success                                                      *  
singleback_success                                                      
empty_success                                                           
def_stop_rate_run                                                    .  
def_stop_rate_pass                                                      
avg_pass_rushers                                                        
avg_box_defenders                                                       
cover0_rate                                                             
cover1_rate                                                             
cover2_rate                                                             
cover3_rate                                                             
cover4_rate                                                             
cover6_rate                                                             
two_man_rate                                                            
prevent_rate                                                         ** 
home_attendance                                                         
roof_outdoors                                                           
posteam_type_away                                                       
offense_formation_EMPTY                                                 
offense_formation_SHOTGUN                                               
offense_formation_SINGLEBACK                                            
offense_player_1_present                                             ** 
offense_player_2_present                                                
offense_player_4_present                                                
offense_player_5_present                                                
offense_player_6_present                                                
offense_player_8_present                                             ** 
offense_player_9_present                                             *  
offense_player_10_present                                               
offense_player_11_present                                               
offense_player_12_present                                            ** 
offense_player_14_present                                               
offense_player_15_present                                               
offense_player_16_present                                               
offense_player_17_present                                               
offense_player_20_present                                               
offense_player_22_present                                               
offense_player_23_present                                               
offense_player_24_present                                            ***
offense_player_9_receiving_concept_screen_grades_pass_route_12w      *  
offense_player_9_receiving_depth_medium_yards_per_reception_12w      ** 
offense_player_9_receiving_grades_yprr_12w                              
offense_player_9_blocking_grades_grades_offense_12w                  .  
offense_player_9_run_blocking_zone_snap_counts_run_block_12w            
offense_player_1_offense_blocking_grades_offense_3y                     
offense_player_9_run_blocking_gap_grades_run_block_12w               .  
offense_player_9_receiving_vs_scheme_zone_targets_percent_12w           
offense_player_1_passing_concept_pa_grades_offense_12w                  
offense_player_1_passing_concept_pa_qb_rating_12w                       
offense_player_9_receiving_concept_slot_grades_pass_route_12w           
offense_player_9_blocking_grades_block_percent_12w                   *  
offense_player_14_run_blocking_snap_counts_run_block_12w                
offense_player_4_rushing_grades_first_downs_12w                         
offense_player_8_blocking_grades_snap_counts_run_block_12w           *  
offense_player_9_receiving_vs_scheme_man_pass_plays_12w                 
offense_player_9_receiving_grades_grades_offense_12w                    
offense_player_14_pass_blocking_pass_block_percent_2w                .  
offense_player_9_receiving_depth_medium_longest_12w                     
offense_player_9_receiving_depth_medium_receptions_12w               .  
offense_player_9_receiving_vs_scheme_zone_route_rate_12w             *  
defense_player_1_present                                             .  
defense_player_2_present                                             .  
defense_player_3_present                                                
defense_player_4_present                                                
defense_player_5_present                                                
defense_player_6_present                                                
defense_player_9_present                                                
defense_player_10_present                                               
defense_player_11_present                                               
defense_player_12_present                                               
defense_player_13_present                                            *  
defense_player_14_present                                               
defense_player_15_present                                               
defense_player_16_present                                               
defense_player_17_present                                               
defense_player_18_present                                               
defense_player_19_present                                               
defense_player_20_present                                               
defense_player_21_present                                               
defense_player_22_present                                               
defense_player_23_present                                               
defense_player_3_defensive_grades_snap_counts_run_defense_12w           
defense_player_3_defensive_grades_snap_counts_dl_b_gap_12w              
defense_player_3_defensive_grades_grades_tackle_12w                  ***
defense_player_3_run_defense_grades_grades_defense_12w                  
defense_player_3_run_defense_grades_grades_tackle_12w                ***
defense_player_3_run_defense_grades_tackles_12w                         
defense_player_3_pass_rush_grades_grades_pass_rush_defense_12w          
defense_player_3_pass_rushing_productivity_lhs_pass_rush_snaps_12w      
defense_player_3_run_defense_grades_run_stop_opp_12w                    
defense_player_3_defensive_grades_snap_counts_defense_12w               
defense_player_3_pass_rush_grades_snap_counts_pass_play_12w             
defense_player_3_run_defense_grades_snap_counts_run_12w                 
defense_player_3_defensive_grades_assists_12w                           
defense_player_3_defense_summary_grades_defense_3y                      
defense_player_3_defensive_grades_stops_12w                          .  
defense_player_3_defensive_grades_snap_counts_pass_rush_12w             
defense_player_3_defensive_grades_grades_run_defense_12w                
defense_player_3_pass_rushing_productivity_pass_rush_percent_12w        
defense_player_3_pass_rushing_productivity_lhs_pass_rush_percent_12w    
defense_player_3_defense_summary_grades_run_defense_3y                  
defense_player_3_run_defense_grades_grades_defense_penalty_12w          
defense_player_20_slot_coverage_coverage_snaps_12w                   .  
defense_player_3_pass_rush_grades_pass_rush_wins_12w                    
defense_player_3_defense_summary_snap_counts_pass_rush_3y            .  
defense_player_3_run_defense_grades_stops_12w                           
yardline_11_20                                                       *  
yardline_21_30                                                       *  
yardline_31_40                                                       *  
yardline_41_50                                                       ***
yardline_51_60                                                       *  
yardline_61_70                                                       ** 
yardline_71_80                                                       ** 
yardline_81_90                                                       ** 
yardline_91_100                                                         
year2017_team_BUF                                                       
year2017_team_CHI                                                       
year2017_team_CLE                                                       
year2017_team_DAL                                                       
year2017_team_DET                                                       
year2017_team_GB                                                     *  
year2017_team_HOU                                                       
year2017_team_MIA                                                       
year2017_team_MIN                                                       
year2017_team_NE                                                        
year2017_team_SF                                                        
year2017_team_BAL                                                       
year2017_team_DEN                                                       
year2017_team_LA                                                        
year2017_team_NYG                                                       
year2017_team_OAK                                                       
year2017_team_SEA                                                       
year2017_team_CAR                                                       
year2017_team_CIN                                                       
year2017_team_IND                                                       
year2017_team_NO                                                        
year2017_team_PHI                                                       
year2017_team_PIT                                                       
year2017_team_TEN                                                       
year2017_team_WAS                                                       
year2017_team_KC                                                        
year2017_team_LAC                                                       
year2017_team_NYJ                                                       
year2017_team_TB                                                        
year2017_team_ATL                                                       
year2017_team_JAX                                                       
year2018_team_ARI                                                       
year2018_team_BAL                                                       
year2018_team_CAR                                                       
year2018_team_CLE                                                       
year2018_team_DET                                                       
year2018_team_HOU                                                       
year2018_team_IND                                                       
year2018_team_KC                                                        
year2018_team_NYG                                                       
year2018_team_OAK                                                       
year2018_team_PHI                                                       
year2018_team_SEA                                                       
year2018_team_BUF                                                       
year2018_team_CHI                                                       
year2018_team_CIN                                                       
year2018_team_DAL                                                       
year2018_team_DEN                                                       
year2018_team_GB                                                        
year2018_team_LAC                                                       
year2018_team_NE                                                        
year2018_team_NO                                                        
year2018_team_PIT                                                       
year2018_team_SF                                                        
year2018_team_MIA                                                       
year2018_team_MIN                                                       
year2018_team_NYJ                                                       
year2018_team_TB                                                        
year2018_team_ATL                                                       
year2018_team_JAX                                                       
year2018_team_LA                                                        
year2018_team_TEN                                                       
year2018_team_WAS                                                       
year2019_team_ARI                                                       
year2019_team_BUF                                                       
year2019_team_CHI                                                       
year2019_team_CLE                                                       
year2019_team_DAL                                                       
year2019_team_IND                                                       
year2019_team_JAX                                                       
year2019_team_KC                                                        
year2019_team_LAC                                                       
year2019_team_MIN                                                       
year2019_team_NE                                                        
year2019_team_NO                                                        
year2019_team_PHI                                                       
year2019_team_SEA                                                       
year2019_team_SF                                                        
year2019_team_TB                                                        
year2019_team_BAL                                                       
year2019_team_CAR                                                       
year2019_team_DEN                                                       
year2019_team_DET                                                       
year2019_team_HOU                                                       
year2019_team_LA                                                        
year2019_team_MIA                                                       
year2019_team_NYG                                                       
year2019_team_NYJ                                                       
year2019_team_OAK                                                       
year2019_team_PIT                                                       
year2019_team_TEN                                                       
year2019_team_CIN                                                       
year2019_team_WAS                                                       
year2019_team_ATL                                                       
year2019_team_GB                                                        
year2020_team_ATL                                                       
year2020_team_BAL                                                       
year2020_team_BUF                                                       
year2020_team_CAR                                                       
year2020_team_CIN                                                       
year2020_team_DEN                                                       
year2020_team_DET                                                       
year2020_team_JAX                                                       
year2020_team_KC                                                        
year2020_team_LA                                                        
year2020_team_MIN                                                       
year2020_team_NE                                                        
year2020_team_NO                                                        
year2020_team_NYG                                                       
year2020_team_SF                                                        
year2020_team_WAS                                                       
year2020_team_CHI                                                       
year2020_team_DAL                                                       
year2020_team_GB                                                        
year2020_team_HOU                                                       
year2020_team_MIA                                                       
year2020_team_NYJ                                                       
year2020_team_TB                                                        
year2020_team_TEN                                                       
year2020_team_ARI                                                       
year2020_team_CLE                                                       
year2020_team_IND                                                       
year2020_team_LAC                                                       
year2020_team_PHI                                                       
year2020_team_SEA                                                       
year2020_team_LV                                                        
year2020_team_PIT                                                       
year2021_team_ATL                                                       
year2021_team_BUF                                                       
year2021_team_CIN                                                       
year2021_team_DAL                                                       
year2021_team_DEN                                                       
year2021_team_DET                                                       
year2021_team_KC                                                        
year2021_team_LA                                                        
year2021_team_LV                                                        
year2021_team_MIN                                                       
year2021_team_NE                                                        
year2021_team_NO                                                        
year2021_team_NYG                                                       
year2021_team_SF                                                        
year2021_team_TEN                                                       
year2021_team_ARI                                                       
year2021_team_BAL                                                       
year2021_team_CAR                                                       
year2021_team_CHI                                                       
year2021_team_GB                                                        
year2021_team_IND                                                       
year2021_team_LAC                                                       
year2021_team_MIA                                                       
year2021_team_NYJ                                                       
year2021_team_PHI                                                       
year2021_team_SEA                                                       
year2021_team_TB                                                        
year2021_team_WAS                                                       
year2021_team_CLE                                                       
year2021_team_HOU                                                       
year2021_team_JAX                                                       
year2021_team_PIT                                                       
year2022_team_ARI                                                       
year2022_team_ATL                                                       
year2022_team_CAR                                                       
year2022_team_CHI                                                       
year2022_team_CIN                                                       
year2022_team_HOU                                                       
year2022_team_IND                                                       
year2022_team_LAC                                                       
year2022_team_MIA                                                       
year2022_team_SEA                                                       
year2022_team_TB                                                        
year2022_team_TEN                                                       
year2022_team_WAS                                                       
year2022_team_BAL                                                       
year2022_team_BUF                                                       
year2022_team_DAL                                                       
year2022_team_DET                                                       
year2022_team_GB                                                        
year2022_team_JAX                                                       
year2022_team_KC                                                        
year2022_team_LA                                                        
year2022_team_LV                                                        
year2022_team_NO                                                        
year2022_team_PHI                                                       
year2022_team_PIT                                                       
year2022_team_CLE                                                       
year2022_team_DEN                                                       
year2022_team_MIN                                                       
year2022_team_NE                                                        
year2022_team_NYJ                                                       
year2022_team_NYG                                                       
year2022_team_SF                                                        
year2023_team_BAL                                                       
year2023_team_CHI                                                       
year2023_team_CLE                                                       
year2023_team_GB                                                        
year2023_team_IND                                                       
year2023_team_KC                                                        
year2023_team_LAC                                                       
year2023_team_LV                                                        
year2023_team_MIA                                                       
year2023_team_MIN                                                       
year2023_team_NO                                                        
year2023_team_NYG                                                       
year2023_team_SEA                                                       
year2023_team_SF                                                        
year2023_team_WAS                                                       
year2023_team_ATL                                                       
year2023_team_BUF                                                       
year2023_team_CAR                                                       
year2023_team_DAL                                                       
year2023_team_DEN                                                       
year2023_team_HOU                                                       
year2023_team_LA                                                        
year2023_team_NE                                                        
year2023_team_PHI                                                       
year2023_team_PIT                                                       
year2023_team_TEN                                                       
year2023_team_ARI                                                       
year2023_team_CIN                                                       
year2023_team_DET                                                       
year2023_team_TB                                                        
year2023_team_JAX                                                       
year2023_team_NYJ                                                       
is_first_half                                                           
time_in_half                                                            
GIMR                                                                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>hashtagged out just incased i missed somthing for this first knitt</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get vifs</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(car)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#vif(ols_model)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Heckman Selection Analysis"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r options, include=FALSE}</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print=</span><span class="dv">10000</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"predict_outcome.csv.gz"</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>select_data <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"predict_select.csv.gz"</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>select_data[, attempt <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(attempt))]</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the XGBoost matrices</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span> <span class="sc">-</span> attempt <span class="sc">-</span> my_id, <span class="at">data =</span> select_data)</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(select_data<span class="sc">$</span>attempt))</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create parameter grid</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="at">by =</span> <span class="fl">0.002</span>),</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">seq</span>(<span class="dv">7</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),        </span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>),                </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">by =</span> <span class="dv">1</span>),                  </span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),               </span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">seq</span>(<span class="dv">300</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">50</span>)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample grid points</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>conf_lev <span class="ot">&lt;-</span> .<span class="dv">95</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>num_max <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>conf_lev)<span class="sc">/</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>num_max<span class="sc">/</span><span class="fu">nrow</span>(grid)))</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(grid), n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>rgrid <span class="ot">&lt;-</span> grid[ind, ]</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up parallel processing</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation phase</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Phase 1: Validation Phase</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>n_validations <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>validation_results <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(rgrid), <span class="at">ncol =</span> n_validations)</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rgrid)) {</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("\nTesting parameter set", j, "of", nrow(rgrid), "\n")</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_validations) {</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create validation split</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs), T))</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>    train_x <span class="ot">&lt;-</span> xs[idx, ]</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>    train_y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>    val_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>idx, ]</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>    val_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>idx]</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Undersample majority class in training data</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>    train_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>    train_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get number of minority class samples</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>    n_minority <span class="ot">&lt;-</span> <span class="fu">length</span>(train_idx_1)</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly sample from majority class</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>    train_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(train_idx_0, n_minority)</span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine indices for balanced dataset</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>    balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(train_idx_0_sampled, train_idx_1)</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create balanced training dataset</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>    train_x_balanced <span class="ot">&lt;-</span> train_x[balanced_idx, ]</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>    train_y_balanced <span class="ot">&lt;-</span> train_y[balanced_idx]</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>    prm <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">booster =</span> <span class="st">"gbtree"</span>,</span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> rgrid[j, <span class="st">"max_depth"</span>],</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> rgrid[j, <span class="st">"eta"</span>],</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> rgrid[j, <span class="st">"subsample"</span>],</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> rgrid[j, <span class="st">"colsample_bytree"</span>],</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">gamma =</span> rgrid[j, <span class="st">"gamma"</span>],</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> rgrid[j, <span class="st">"min_child_weight"</span>],</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> rgrid[j, <span class="st">"alpha"</span>],</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">lambda =</span> rgrid[j, <span class="st">"lambda"</span>],</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">nthread =</span> nc</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>    dm_train <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_x_balanced, <span class="at">label =</span> train_y_balanced)</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>    mdl <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> prm,</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dm_train,</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> rgrid[j, <span class="st">"nrounds"</span>],</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> val_x))</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(p, val_y)</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>    validation_results[j, i] <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mean AUC:"</span>, <span class="fu">mean</span>(validation_results[j,]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"SD AUC:"</span>, <span class="fu">sd</span>(validation_results[j,]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Run 100 tests with best parameters</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Running 100 test iterations with best parameters...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>test_aucs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>best_params_idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">rowMeans</span>(validation_results))</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> rgrid[best_params_idx,]</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model with best parameters</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>best_params_list <span class="ot">&lt;-</span> <span class="fu">as.list</span>(best_params[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(best_params) <span class="sc">==</span> <span class="st">"nrounds"</span>)])</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>booster <span class="ot">&lt;-</span> <span class="st">"gbtree"</span></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>objective <span class="ot">&lt;-</span> <span class="st">"binary:logistic"</span></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>best_params_list<span class="sc">$</span>nthread <span class="ot">&lt;-</span> nc</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat("\nIteration", i, "of 100\n")       </span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create test split</span></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs), T))</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>  train_x <span class="ot">&lt;-</span> xs[idx, ]</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>  train_y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>  test_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>idx, ]</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>  test_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>idx]</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Undersample training data</span></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>  train_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>  train_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(train_y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>  n_minority <span class="ot">&lt;-</span> <span class="fu">length</span>(train_idx_1)</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>  train_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(train_idx_0, n_minority)</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>  balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(train_idx_0_sampled, train_idx_1)</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create balanced training dataset</span></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>  train_x_balanced <span class="ot">&lt;-</span> train_x[balanced_idx, ]</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>  train_y_balanced <span class="ot">&lt;-</span> train_y[balanced_idx]</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train model</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>  dm_train <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_x_balanced, <span class="at">label =</span> train_y_balanced)</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>  mdl <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> best_params_list,</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dm_train,</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> best_params[[<span class="st">"nrounds"</span>]],</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test on unbalanced test set</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x))</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(p, test_y)</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>  test_aucs[i] <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Test Results over 100 iterations:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean AUC:"</span>, <span class="fu">mean</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SD AUC:"</span>, <span class="fu">sd</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"95% CI:"</span>, <span class="fu">mean</span>(test_aucs) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(test_aucs), </span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>    <span class="st">"to"</span>, <span class="fu">mean</span>(test_aucs) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(test_aucs), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Now train final model on full data for z scores</span></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>final_idx_0 <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>final_idx_1 <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>n_minority_final <span class="ot">&lt;-</span> <span class="fu">length</span>(final_idx_1)</span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>final_idx_0_sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(final_idx_0, n_minority_final)</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>final_balanced_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(final_idx_0_sampled, final_idx_1)</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Create balanced final dataset</span></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>xs_balanced <span class="ot">&lt;-</span> xs[final_balanced_idx, ]</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>y_balanced <span class="ot">&lt;-</span> y[final_balanced_idx]</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>dm_full <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> xs_balanced, <span class="at">label =</span> y_balanced)</span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>final_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> best_params_list,</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dm_full,</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> best_params[[<span class="st">"nrounds"</span>]],</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a><span class="co"># Get probability predictions (z) for ALL data</span></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_model, <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> xs))</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals for XGBoost predictions</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(select_data<span class="sc">$</span>attempt))</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> z</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of residuals</span></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(residuals, <span class="at">main=</span><span class="st">"Distribution of XGBoost Model Residuals"</span>, <span class="at">xlab=</span><span class="st">"Residual"</span>, <span class="at">breaks=</span><span class="dv">100</span>)</span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a><span class="co"># plot out the z values\</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(z), </span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Density of Z Predictions"</span>,</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Predicted Probability of Attempt"</span>,</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Density"</span>)</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate GIMR (lambda) This is Generalized inverse mills ratio</span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>GIMR <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(<span class="fu">qnorm</span>(z)) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">qnorm</span>(z)))</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GIMR to the data</span></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>select_data[, GIMR <span class="sc">:</span><span class="er">=</span> GIMR]</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Print variable importa</span></span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data.table with just my_id and GIMR from select_data</span></span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>GIMR_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">my_id =</span> select_data<span class="sc">$</span>my_id, <span class="at">GIMR =</span> GIMR)</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GIMR to outcome_data by matching on my_id</span></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a>outcome_data[GIMR_dt, GIMR <span class="sc">:</span><span class="er">=</span> i.GIMR, on <span class="ot">=</span> <span class="st">"my_id"</span>]</span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a><span class="fu"># step 2 outcome_data</span></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a><span class="co">#kill - my_id</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> outcome_data[, my_id <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>outcome_data[, year2017_team_ARI <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>outcome_data <span class="ot">&lt;-</span> outcome_data[, yardline_1_10<span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>outcome_data[, conversion <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(conversion))]</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Then run OLS with GIMR correction</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>ols_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(conversion <span class="sc">~</span>  ., <span class="at">data =</span> outcome_data)</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lmtest"</span>)</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sandwich"</span>)</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a><span class="co"># heroskedastic adjusted SEs</span></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols_model, <span class="at">vcov =</span> <span class="fu">vcovHC</span>(ols_model, <span class="at">type =</span> <span class="st">"HC0"</span>))</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>hashtagged out just incased i missed somthing for this first knitt</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a><span class="co"># get vifs</span></span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a><span class="co">#library(car)</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a><span class="co">#vif(ols_model)</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>